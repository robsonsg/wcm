import{k as R,l as A,w as F}from"./chunk-HOG6MQQB.js";import{Bb as I,Dc as k,Kb as a,Lb as n,Qb as b,Vb as h,Wb as p,a as _,aa as y,ab as o,b as S,fb as M,fc as w,gc as r,hc as l,ic as c,lb as T,oa as f,pa as C,rb as u,zb as g}from"./chunk-5HUFPCHR.js";var j=(()=>{class s{groupMessagesIntoConversations(e){let t=new Map;return e.forEach(i=>{let d=[i.senderId,i.receiverId].sort(),v=d.join("-");t.has(v)||t.set(v,{id:`conv-${v}`,participants:d,messages:[],unreadCount:0,updatedAt:new Date(i.timestamp)});let x=t.get(v);x.messages.push({id:i.id,senderId:i.senderId,receiverId:i.receiverId,content:i.content,timestamp:new Date(i.timestamp),isRead:i.isRead,type:"text"}),i.isRead||x.unreadCount++;let E=new Date(i.timestamp);E>x.updatedAt&&(x.updatedAt=E)}),t.forEach(i=>{i.messages.sort((d,v)=>d.timestamp.getTime()-v.timestamp.getTime())}),Array.from(t.values()).sort((i,d)=>d.updatedAt.getTime()-i.updatedAt.getTime())}filterConversationsByParticipant(e,t){return e.filter(i=>i.participants.includes(t))}markConversationAsRead(e,t){let i=e.messages.map(d=>d.receiverId===t&&!d.isRead?S(_({},d),{isRead:!0}):d);return S(_({},e),{messages:i,unreadCount:0})}getLastMessage(e){return e.messages.length>0?e.messages[e.messages.length-1]:null}static \u0275fac=function(t){return new(t||s)};static \u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function V(s,m){if(s&1&&(a(0,"div",30),r(1),n()),s&2){let e=p().$implicit;o(),c(" ",e.unreadCount," ")}}function L(s,m){if(s&1){let e=b();a(0,"div",21),h("click",function(){let i=f(e).$implicit,d=p();return C(d.selectConversation(i))}),a(1,"div",22)(2,"div",23)(3,"div",24)(4,"div",25)(5,"span",26),r(6),n(),u(7,V,2,1,"div",27),n(),a(8,"p",28),r(9),n()(),a(10,"div",29),r(11),n()()()()}if(s&2){let e=m.$implicit,t=p();I("ring-2",(t.selectedConversation==null?null:t.selectedConversation.id)===e.id)("ring-primary",(t.selectedConversation==null?null:t.selectedConversation.id)===e.id),o(6),c(" ",e.participants.join(" \u2194 ")," "),o(),g("ngIf",e.unreadCount>0),o(2),c(" ",t.getLastMessagePreview(e)," "),o(2),c(" ",t.formatTimestamp(e.updatedAt)," ")}}function D(s,m){s&1&&(a(0,"span",46),r(1," n\xE3o lida "),n())}function N(s,m){if(s&1&&(a(0,"div",41)(1,"div",42),r(2),a(3,"time",43),r(4),n(),u(5,D,2,0,"span",44),n(),a(6,"div",45),r(7),n()()),s&2){let e=m.$implicit,t=p(2);I("chat-start",e.senderId===t.selectedConversation.participants[0])("chat-end",e.senderId===t.selectedConversation.participants[1]),o(2),c(" ",e.senderId," "),o(2),c(" ",t.formatTimestamp(e.timestamp)," "),o(),g("ngIf",!e.isRead),o(),I("chat-bubble-primary",e.senderId===t.selectedConversation.participants[0])("chat-bubble-secondary",e.senderId===t.selectedConversation.participants[1]),o(),c(" ",e.content," ")}}function P(s,m){if(s&1){let e=b();a(0,"div",7)(1,"div",31)(2,"div",17)(3,"div",18),r(4,"ID da Conversa"),n(),a(5,"div",32),r(6),n()(),a(7,"div",17)(8,"div",18),r(9,"Mensagens"),n(),a(10,"div",32),r(11),n()(),a(12,"div",17)(13,"div",18),r(14,"N\xE3o Lidas"),n(),a(15,"div",32),r(16),n()()(),a(17,"div",33)(18,"div",4)(19,"div",34)(20,"h3",35),r(21,"Mensagens"),n(),a(22,"button",36),h("click",function(){f(e);let i=p();return C(i.markAsRead(i.selectedConversation))}),r(23," Marcar como Lida "),n()(),a(24,"div",37),u(25,N,8,12,"div",38),n()()(),a(26,"div",33)(27,"div",4)(28,"h3",35),r(29,"Estrutura JSON"),n(),a(30,"div",39)(31,"pre",40)(32,"code"),r(33),n()()()()()()}if(s&2){let e=p();o(6),l(e.selectedConversation.id),o(5),l(e.selectedConversation.messages.length),o(5),l(e.selectedConversation.unreadCount),o(9),g("ngForOf",e.selectedConversation.messages)("ngForTrackBy",e.trackByMessageId),o(8),l(e.getConversationJson(e.selectedConversation))}}function Z(s,m){s&1&&(a(0,"div",33)(1,"div",47)(2,"p",48),r(3," Clique em uma conversa \xE0 esquerda para ver os detalhes "),n()()())}var G=(()=>{class s{conversationService;conversations=[];selectedConversation=null;rawMessages=[{id:"m1",senderId:"user-1",receiverId:"user-2",content:"Bruno, vamos come\xE7ar aquele projeto novo?",timestamp:"2025-05-01T09:00:00Z",isRead:!0},{id:"m2",senderId:"user-2",receiverId:"user-1",content:"Perfeito! J\xE1 preparei o ambiente de desenvolvimento.",timestamp:"2025-05-01T09:30:00Z",isRead:!0},{id:"m67",senderId:"user-1",receiverId:"user-2",content:"Oi, bom dia! Queria confirmar se vamos ter a reuni\xE3o hoje \xE0s 10h?",timestamp:"2025-06-09T08:00:00Z",isRead:!0},{id:"m68",senderId:"user-2",receiverId:"user-1",content:"Sim, est\xE1 confirmada. A sala j\xE1 foi reservada.",timestamp:"2025-06-09T08:01:00Z",isRead:!1},{id:"m71",senderId:"user-3",receiverId:"user-1",content:"Ana, voc\xEA viu o novo filme do Christopher Nolan?",timestamp:"2025-06-10T09:00:00Z",isRead:!1},{id:"m72",senderId:"user-4",receiverId:"user-1",content:"Consegui resolver aquele bug do projeto!",timestamp:"2025-06-10T10:30:00Z",isRead:!1}];constructor(e){this.conversationService=e}ngOnInit(){this.processMessages()}processMessages(){this.conversations=this.conversationService.groupMessagesIntoConversations(this.rawMessages)}selectConversation(e){this.selectedConversation=e}markAsRead(e){let t=this.conversationService.markConversationAsRead(e,"user-1"),i=this.conversations.findIndex(d=>d.id===e.id);i!==-1&&(this.conversations[i]=t,this.selectedConversation=t)}getLastMessagePreview(e){let t=this.conversationService.getLastMessage(e);return t?`${t.content.substring(0,50)}...`:"Sem mensagens"}formatTimestamp(e){return e.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getConversationJson(e){return JSON.stringify(e,null,2)}getTotalMessages(){return this.conversations.reduce((e,t)=>e+t.messages.length,0)}getTotalUnreadMessages(){return this.conversations.reduce((e,t)=>e+t.unreadCount,0)}trackByConversationId(e,t){return t.id}trackByMessageId(e,t){return t.id}static \u0275fac=function(t){return new(t||s)(M(j))};static \u0275cmp=T({type:s,selectors:[["app-conversation-mapper"]],decls:46,vars:9,consts:[["noSelection",""],[1,"min-h-screen","bg-base-200","p-4"],[1,"max-w-7xl","mx-auto"],[1,"card","bg-base-100","shadow-xl"],[1,"card-body"],[1,"card-title","text-3xl","mb-6","text-primary"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"space-y-3","max-h-96","overflow-y-auto"],["class","card bg-base-200 cursor-pointer transition-all hover:shadow-md",3,"ring-2","ring-primary","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-xl","font-semibold","mb-4"],["class","space-y-4",4,"ngIf","ngIfElse"],[1,"mt-8"],[1,"stats","stats-vertical","lg:stats-horizontal","shadow","w-full"],[1,"stat"],[1,"stat-title"],[1,"stat-value"],[1,"stat-desc"],[1,"card","bg-base-200","cursor-pointer","transition-all","hover:shadow-md",3,"click"],[1,"card-body","p-4"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"flex","items-center","gap-2"],[1,"font-medium"],["class","badge badge-error badge-sm",4,"ngIf"],[1,"text-sm","text-base-content","opacity-70","mt-1"],[1,"text-xs","text-base-content","opacity-60"],[1,"badge","badge-error","badge-sm"],[1,"stats","shadow","w-full"],[1,"stat-value","text-lg"],[1,"card","bg-base-200"],[1,"flex","justify-between","items-center","mb-4"],[1,"card-title","text-lg"],[1,"btn","btn-sm","btn-outline",3,"click"],[1,"space-y-2","max-h-64","overflow-y-auto"],["class","chat",3,"chat-start","chat-end",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mockup-code"],[1,"text-xs","overflow-x-auto"],[1,"chat"],[1,"chat-header"],[1,"text-xs","opacity-50","ml-2"],["class","badge badge-error badge-xs ml-2",4,"ngIf"],[1,"chat-bubble"],[1,"badge","badge-error","badge-xs","ml-2"],[1,"card-body","text-center"],[1,"text-base-content","opacity-70"]],template:function(t,i){if(t&1){let d=b();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h1",5),r(5," Conversor de Mensagens para Conversas - Angular 19 "),n(),a(6,"div",6)(7,"div",7)(8,"div",8)(9,"h2",9),r(10),n(),a(11,"button",10),h("click",function(){return f(d),C(i.processMessages())}),r(12," Reprocessar "),n()(),a(13,"div",11),u(14,L,12,8,"div",12),n()(),a(15,"div",7)(16,"h2",13),r(17),n(),u(18,P,34,6,"div",14)(19,Z,4,0,"ng-template",null,0,k),n()(),a(21,"div",15)(22,"h2",13),r(23,"Resumo Geral"),n(),a(24,"div",16)(25,"div",17)(26,"div",18),r(27,"Total de Conversas"),n(),a(28,"div",19),r(29),n(),a(30,"div",20),r(31,"Agrupadas por participantes"),n()(),a(32,"div",17)(33,"div",18),r(34,"Total de Mensagens"),n(),a(35,"div",19),r(36),n(),a(37,"div",20),r(38,"Em todas as conversas"),n()(),a(39,"div",17)(40,"div",18),r(41,"Mensagens N\xE3o Lidas"),n(),a(42,"div",19),r(43),n(),a(44,"div",20),r(45,"Aguardando leitura"),n()()()()()()()()}if(t&2){let d=w(20);o(10),c(" Conversas Agrupadas (",i.conversations.length,") "),o(4),g("ngForOf",i.conversations)("ngForTrackBy",i.trackByConversationId),o(3),c(" ",i.selectedConversation?"Detalhes da Conversa":"Selecione uma conversa"," "),o(),g("ngIf",i.selectedConversation)("ngIfElse",d),o(11),l(i.conversations.length),o(7),l(i.getTotalMessages()),o(7),l(i.getTotalUnreadMessages())}},dependencies:[F,R,A],encapsulation:2})}return s})();export{G as ConversationMapperComponent};
