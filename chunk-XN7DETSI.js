import{f as U,i as Q,o as H,p as J,q as K,t as X}from"./chunk-EUYLE5IP.js";import{k as L,l as N,s as G,u as j,v as W,w as q}from"./chunk-RLCM72IK.js";import{$b as w,Db as P,Ib as D,Jb as m,Ra as r,Vb as o,Wb as x,Xb as d,Yb as z,ab as O,ac as F,bc as I,gb as h,mc as v,nb as B,oa as b,ob as p,oc as R,pa as E,pc as C,sb as S,ub as M,vb as k,wb as $,xb as n,yb as i,zb as f}from"./chunk-27GLVKKX.js";function Z(l,c){if(l&1){let e=P();n(0,"button",49),D("click",function(){b(e);let t=m(2);return E(t.expandirTodos())}),f(1,"i",50),o(2," Expandir Todos "),i()}}function ee(l,c){if(l&1){let e=P();n(0,"button",51),D("click",function(){b(e);let t=m(2);return E(t.recolherTodos())}),f(1,"i",52),o(2," Recolher Todos "),i()}}function te(l,c){if(l&1){let e=P();n(0,"div",2)(1,"div",3)(2,"h5"),f(3,"i",22),o(4," Configura\xE7\xF5es de Visualiza\xE7\xE3o"),i()(),n(5,"div",5)(6,"div",6)(7,"div",7)(8,"label",23),o(9,"Agrupar Por:"),i(),n(10,"select",24),I("ngModelChange",function(t){b(e);let s=m();return F(s.tipoVisao,t)||(s.tipoVisao=t),E(t)}),D("change",function(){b(e);let t=m();return E(t.atualizarVisao())}),n(11,"option",25),o(12,"\u{1F468}\u200D\u2695\uFE0F Profissional Individual"),i(),n(13,"option",26),o(14,"\u{1F3E5} Categoria Profissional"),i(),n(15,"option",27),o(16,"\u{1F3E2} Conv\xEAnio"),i(),n(17,"option",28),o(18,"\u{1F464} Paciente"),i()()(),n(19,"div",29)(20,"label",23),o(21,"N\xEDvel de Detalhamento:"),i(),n(22,"select",24),I("ngModelChange",function(t){b(e);let s=m();return F(s.nivelDetalhe,t)||(s.nivelDetalhe=t),E(t)}),D("change",function(){b(e);let t=m();return E(t.atualizarVisao())}),n(23,"option",30),o(24,"\u{1F4CA} Resumido"),i(),n(25,"option",31),o(26,"\u{1F50D} Detalhado com Refer\xEAncias"),i(),n(27,"option",32),o(28,"\u{1F4CB} Completo com Hist\xF3rico"),i()()(),n(29,"div",29)(30,"label",23),o(31,"Ordenar Por:"),i(),n(32,"select",24),I("ngModelChange",function(t){b(e);let s=m();return F(s.ordenacao,t)||(s.ordenacao=t),E(t)}),D("change",function(){b(e);let t=m();return E(t.atualizarVisao())}),n(33,"option",33),o(34,"\u{1F4B0} Total Pago"),i(),n(35,"option",34),o(36,"\u{1F4B5} Total Faturado"),i(),n(37,"option",35),o(38,"\u{1F4C8} Margem"),i(),n(39,"option",36),o(40,"\u{1F3AF} Lucro Bruto"),i()()(),n(41,"div",37)(42,"label",38),o(43,"\xA0"),i(),n(44,"div",39)(45,"button",40),D("click",function(){b(e);let t=m();return E(t.atualizarVisao())}),f(46,"i",41),o(47," Atualizar "),i()()()(),n(48,"div",42)(49,"div",43)(50,"div",44)(51,"button",45),D("click",function(){b(e);let t=m();return E(t.exportarDados())}),f(52,"i",46),o(53," Exportar CSV "),i(),h(54,Z,3,0,"button",47)(55,ee,3,0,"button",48),i()()()()()}if(l&2){let e=m();r(10),w("ngModel",e.tipoVisao),r(12),w("ngModel",e.nivelDetalhe),r(10),w("ngModel",e.ordenacao),r(22),p("ngIf",e.nivelDetalhe!=="resumido"),r(),p("ngIf",e.nivelDetalhe!=="resumido")}}function ie(l,c){if(l&1&&(n(0,"div",2)(1,"div",3)(2,"h5"),f(3,"i",53),o(4," Resumo Executivo"),i()(),n(5,"div",5)(6,"div",54)(7,"div",37)(8,"div",55)(9,"h3",56),o(10),v(11,"currency"),i(),n(12,"small",57),o(13,"Total Pago aos Profissionais"),i(),n(14,"div",58)(15,"small",59),o(16,"Custo direto"),i()()()(),n(17,"div",37)(18,"div",60)(19,"h3",61),o(20),v(21,"currency"),i(),n(22,"small",57),o(23,"Total Or\xE7ado"),i(),n(24,"div",58)(25,"small",59),o(26,"Previs\xE3o de receita"),i()()()(),n(27,"div",37)(28,"div",62)(29,"h3",63),o(30),v(31,"currency"),i(),n(32,"small",57),o(33,"Total Faturado"),i(),n(34,"div",58)(35,"small",59),o(36,"Receita realizada"),i()()()(),n(37,"div",37)(38,"div",64)(39,"h3",65),o(40),v(41,"currency"),i(),n(42,"small",57),o(43,"Custo Total"),i(),n(44,"div",58)(45,"small",59),o(46,"Custos operacionais"),i()()()(),n(47,"div",37)(48,"div",66)(49,"h3"),o(50),v(51,"currency"),i(),n(52,"small",57),o(53,"Lucro Bruto"),i(),n(54,"div",58)(55,"small",59),o(56,"Faturado - Custos"),i()()()(),n(57,"div",37)(58,"div",66)(59,"h3"),o(60),v(61,"percent"),i(),n(62,"small",57),o(63,"Margem"),i(),n(64,"div",58)(65,"small",59),o(66,"% do faturamento"),i()()()()()()()),l&2){let e=m();r(10),x(C(11,14,e.resumoGeral.totalPago,"BRL","symbol","1.2-2")),r(10),x(C(21,19,e.resumoGeral.totalOrcado,"BRL","symbol","1.2-2")),r(10),x(C(31,24,e.resumoGeral.totalFaturado,"BRL","symbol","1.2-2")),r(10),x(C(41,29,e.resumoGeral.custoTotal,"BRL","symbol","1.2-2")),r(8),S(e.resumoGeral.lucroBruto>=0?"bg-success-subtle":"bg-danger-subtle"),r(),S(e.resumoGeral.lucroBruto>=0?"text-success":"text-danger"),r(),d(" ",C(51,34,e.resumoGeral.lucroBruto,"BRL","symbol","1.2-2")," "),r(8),S(e.resumoGeral.margem>=0?"bg-success-subtle":"bg-danger-subtle"),r(),S(e.resumoGeral.margem>=0?"text-success":"text-danger"),r(),d(" ",R(61,39,e.resumoGeral.margem,"1.1-1")," ")}}function ne(l,c){l&1&&(n(0,"th",79),o(1,"A\xE7\xF5es"),i())}function ae(l,c){if(l&1&&(n(0,"span",92),o(1),i()),l&2){let e=m(2).$implicit;r(),d(" \u{1F4CA} ",e.referencias.orcamentos.size," ")}}function oe(l,c){if(l&1&&(n(0,"span",93),o(1),i()),l&2){let e=m(2).$implicit;r(),d(" \u{1F9FE} ",e.referencias.contas.size," ")}}function re(l,c){if(l&1&&(n(0,"div",58)(1,"span",88),o(2),i(),n(3,"span",89),o(4),i(),h(5,ae,2,1,"span",90)(6,oe,2,1,"span",91),i()),l&2){let e=m().$implicit;r(2),d(" \u{1F464} ",e.referencias.pacientes.size," "),r(2),d(" \u{1F3E2} ",e.referencias.convenios.size," "),r(),p("ngIf",e.referencias.orcamentos.size>0),r(),p("ngIf",e.referencias.contas.size>0)}}function le(l,c){if(l&1){let e=P();n(0,"td",94)(1,"button",95),D("click",function(){b(e);let t=m().$index,s=m(2);return E(s.toggleDetalhes(t))}),f(2,"i"),i()()}if(l&2){let e=m().$implicit;r(),S(e.mostrarDetalhes?"btn-outline-danger":"btn-outline-primary"),r(),S(e.mostrarDetalhes?"fas fa-eye-slash":"fas fa-eye")}}function se(l,c){if(l&1&&(n(0,"li"),o(1),i()),l&2){let e=c.$implicit;r(),d(" ",e," ")}}function ce(l,c){if(l&1&&(n(0,"li",59),o(1),i()),l&2){let e=m(2).$implicit;r(),d(" ... e mais ",e.referencias.pacientes.size-5," ")}}function de(l,c){if(l&1&&(n(0,"li"),o(1),i()),l&2){let e=c.$implicit;r(),d(" ",e," ")}}function me(l,c){if(l&1&&(n(0,"li",59),o(1),i()),l&2){let e=m(2).$implicit;r(),d(" ... e mais ",e.referencias.convenios.size-5," ")}}function ue(l,c){if(l&1&&(n(0,"li"),o(1),i()),l&2){let e=c.$implicit;r(),d(" ",e," ")}}function pe(l,c){if(l&1&&(n(0,"li",59),o(1),i()),l&2){let e=m(2).$implicit;r(),d(" ... e mais ",e.referencias.orcamentos.size-5," ")}}function ge(l,c){if(l&1&&(n(0,"li"),o(1),i()),l&2){let e=c.$implicit;r(),d(" ",e," ")}}function _e(l,c){if(l&1&&(n(0,"li",59),o(1),i()),l&2){let e=m(2).$implicit;r(),d(" ... e mais ",e.referencias.contas.size-5," ")}}function fe(l,c){if(l&1&&(n(0,"tr")(1,"td"),o(2),v(3,"date"),i(),n(4,"td"),o(5),i(),n(6,"td",108),o(7),v(8,"currency"),i()()),l&2){let e=c.$implicit;r(2),x(R(3,3,e.dtEntrada,"dd/MM/yy")),r(3),x(e.pacienteNome),r(2),x(C(8,6,e.valorTotalPago,"BRL","symbol","1.2-2"))}}function xe(l,c){if(l&1&&(n(0,"tr")(1,"td"),o(2),i(),n(3,"td"),o(4),i(),n(5,"td",108),o(6),v(7,"currency"),i()()),l&2){let e=c.$implicit;r(2),x(e.orcamento),r(2),x(e.procedimento),r(2),x(C(7,3,e.valorTotal,"BRL","symbol","1.2-2"))}}function ve(l,c){if(l&1&&(n(0,"tr")(1,"td"),o(2),i(),n(3,"td"),o(4),i(),n(5,"td",108),o(6),v(7,"currency"),i()()),l&2){let e=c.$implicit;r(2),x(e.conta),r(2),x(e.procedimento),r(2),x(C(7,3,e.valorTotal,"BRL","symbol","1.2-2"))}}function he(l,c){if(l&1&&(n(0,"div")(1,"div",101)(2,"div",7)(3,"h6",56),f(4,"i",10),o(5),i(),n(6,"div",106)(7,"table",107)(8,"thead")(9,"tr")(10,"th"),o(11,"Data"),i(),n(12,"th"),o(13,"Paciente"),i(),n(14,"th",108),o(15,"Valor"),i()()(),n(16,"tbody"),h(17,fe,9,11,"tr",103),i()()()(),n(18,"div",7)(19,"h6",61),f(20,"i",15),o(21),i(),n(22,"div",106)(23,"table",107)(24,"thead")(25,"tr")(26,"th"),o(27,"Or\xE7amento"),i(),n(28,"th"),o(29,"Procedimento"),i(),n(30,"th",108),o(31,"Valor"),i()()(),n(32,"tbody"),h(33,xe,8,8,"tr",103),i()()()(),n(34,"div",7)(35,"h6",63),f(36,"i",18),o(37),i(),n(38,"div",106)(39,"table",107)(40,"thead")(41,"tr")(42,"th"),o(43,"Conta"),i(),n(44,"th"),o(45,"Procedimento"),i(),n(46,"th",108),o(47,"Valor"),i()()(),n(48,"tbody"),h(49,ve,8,8,"tr",103),i()()()()()()),l&2){let e=m(2).$index,a=m(2);r(5),d(" Remunera\xE7\xF5es (",a.dadosAgrupados[e].detalhes.remuneracao.length,"):"),r(12),p("ngForOf",a.dadosAgrupados[e].detalhes.remuneracao.slice(0,10)),r(4),d(" Or\xE7amentos (",a.dadosAgrupados[e].detalhes.orcamentos.length,"):"),r(12),p("ngForOf",a.dadosAgrupados[e].detalhes.orcamentos.slice(0,10)),r(4),d(" Contas (",a.dadosAgrupados[e].detalhes.contas.length,"):"),r(12),p("ngForOf",a.dadosAgrupados[e].detalhes.contas.slice(0,10))}}function Ce(l,c){if(l&1&&(n(0,"tr",96)(1,"td")(2,"div",97)(3,"div",98)(4,"div",43)(5,"h6",99),f(6,"i",100),o(7," Refer\xEAncias Cruzadas"),i(),n(8,"div",101)(9,"div",29)(10,"strong"),o(11),i(),n(12,"ul",102),h(13,se,2,1,"li",103)(14,ce,2,1,"li",104),i()(),n(15,"div",29)(16,"strong"),o(17),i(),n(18,"ul",102),h(19,de,2,1,"li",103)(20,me,2,1,"li",104),i()(),n(21,"div",29)(22,"strong"),o(23),i(),n(24,"ul",102),h(25,ue,2,1,"li",103)(26,pe,2,1,"li",104),i()(),n(27,"div",29)(28,"strong"),o(29),i(),n(30,"ul",102),h(31,ge,2,1,"li",103)(32,_e,2,1,"li",104),i()()()()(),h(33,he,50,6,"div",105),i()()()),l&2){let e=m().$implicit,a=m(2);r(),B("colspan",a.nivelDetalhe==="resumido"?7:8),r(10),d("\u{1F464} Pacientes (",e.referencias.pacientes.size,"):"),r(2),p("ngForOf",a.Array.from(e.referencias.pacientes).slice(0,5)),r(),p("ngIf",e.referencias.pacientes.size>5),r(3),d("\u{1F3E2} Conv\xEAnios (",e.referencias.convenios.size,"):"),r(2),p("ngForOf",a.Array.from(e.referencias.convenios).slice(0,5)),r(),p("ngIf",e.referencias.convenios.size>5),r(3),d("\u{1F4CA} Or\xE7amentos (",e.referencias.orcamentos.size,"):"),r(2),p("ngForOf",a.Array.from(e.referencias.orcamentos).slice(0,5)),r(),p("ngIf",e.referencias.orcamentos.size>5),r(3),d("\u{1F9FE} Contas (",e.referencias.contas.size,"):"),r(2),p("ngForOf",a.Array.from(e.referencias.contas).slice(0,5)),r(),p("ngIf",e.referencias.contas.size>5),r(),p("ngIf",a.nivelDetalhe==="completo")}}function be(l,c){if(l&1&&(n(0,"tr")(1,"td")(2,"div")(3,"strong"),o(4),i(),f(5,"br"),n(6,"small",59),o(7),i(),h(8,re,7,4,"div",80),i()(),n(9,"td",81),o(10),v(11,"currency"),i(),n(12,"td",82),o(13),v(14,"currency"),i(),n(15,"td",83),o(16),v(17,"currency"),i(),n(18,"td",84),o(19),v(20,"currency"),i(),n(21,"td",85),o(22),v(23,"currency"),i(),n(24,"td",85),o(25),v(26,"percent"),i(),h(27,le,3,4,"td",86),i(),h(28,Ce,34,14,"tr",87)),l&2){let e=c.$implicit,a=c.$index,t=m(2);S(e.margem<0?"table-warning":""),r(4),x(e.chave),r(3),x(e.descricao),r(),p("ngIf",t.nivelDetalhe!=="resumido"),r(2),d(" ",C(11,17,e.totalPago,"BRL","symbol","1.2-2")," "),r(3),d(" ",C(14,22,e.totalOrcado,"BRL","symbol","1.2-2")," "),r(3),d(" ",C(17,27,e.totalFaturado,"BRL","symbol","1.2-2")," "),r(3),d(" ",C(20,32,e.custoTotal,"BRL","symbol","1.2-2")," "),r(2),S(e.lucroBruto>=0?"text-success":"text-danger"),r(),d(" ",C(23,37,e.lucroBruto,"BRL","symbol","1.2-2")," "),r(2),S(e.margem>=0?"text-success":"text-danger"),r(),d(" ",R(26,42,e.margem,"1.1-1")," "),r(2),p("ngIf",t.nivelDetalhe!=="resumido"),r(),p("ngIf",t.nivelDetalhe!=="resumido"&&(t.dadosAgrupados[a]==null?null:t.dadosAgrupados[a].mostrarDetalhes))}}function Ee(l,c){if(l&1&&(n(0,"div",67)(1,"div",68)(2,"h5"),f(3,"i",69),o(4),i(),n(5,"div")(6,"span",70),o(7),i()()(),n(8,"div",71)(9,"div",72)(10,"table",73)(11,"thead",74)(12,"tr")(13,"th",75),o(14),i(),n(15,"th",76),o(16,"\u{1F4B0} Pago"),i(),n(17,"th",76),o(18,"\u{1F4CA} Or\xE7ado"),i(),n(19,"th",76),o(20,"\u{1F4B5} Faturado"),i(),n(21,"th",76),o(22,"\u26A0\uFE0F Custo"),i(),n(23,"th",76),o(24,"\u{1F3AF} Lucro"),i(),n(25,"th",77),o(26,"\u{1F4C8} Margem"),i(),h(27,ne,2,0,"th",78),i()(),n(28,"tbody"),k(29,be,29,45,null,null,M),i()()()()()),l&2){let e=m();r(4),z(" ",e.getTituloVisao()," (",e.dadosAgrupados.length," registros)"),r(3),d("Total de an\xE1lises: ",e.dadosAgrupados.length,""),r(7),x(e.getColunaAgrupamento()),r(13),p("ngIf",e.nivelDetalhe!=="resumido"),r(2),$(e.dadosAgrupados)}}var Pe=(()=>{class l{remuneracaoData=[];orcamentoData=[];contasData=[];tipoVisao="profissional";nivelDetalhe="resumido";ordenacao="totalPago";dadosAgrupados=[];resumoGeral=null;Array=Array;uploadRemuneracao(e){let a=e.target.files[0];a&&this.lerArquivo(a,"remuneracao")}uploadOrcamento(e){let a=e.target.files[0];a&&this.lerArquivo(a,"orcamento")}uploadContas(e){let a=e.target.files[0];a&&this.lerArquivo(a,"contas")}lerArquivo(e,a){let t=new FileReader;t.onload=s=>{let u=s.target?.result;this.processarArquivo(u,a)},t.readAsText(e,"UTF-8")}processarArquivo(e,a){let t=e.split(`
`).filter(g=>g.trim());if(t.length<2)return;let s=this.parseTabLine(t[0]),u=t.slice(1).map(g=>this.parseTabLine(g));switch(a){case"remuneracao":this.remuneracaoData=u.map(g=>this.mapRemuneracao(s,g)).filter(g=>g.valorTotalPago>0);break;case"orcamento":this.orcamentoData=u.map(g=>this.mapOrcamento(s,g)).filter(g=>g.valorTotal>0);break;case"contas":this.contasData=u.map(g=>this.mapContas(s,g)).filter(g=>g.valorTotal>0);break}this.atualizarVisao()}parseTabLine(e){return e.split("	").map(a=>a.replace(/^"(.+)"$/,"$1").trim())}mapRemuneracao(e,a){let t=u=>a[e.indexOf(u)]||"",s=u=>parseFloat(t(u).replace(",","."))||0;return{profissionalCodigo:t("Profissional C\xF3digo"),profissionalNome:t("Profissional Nome"),profissaoCodigo:t("Profiss\xE3o C\xF3digo"),profissaoDescricao:t("Profiss\xE3o Descri\xE7\xE3o"),pacienteCodigo:t("Paciente C\xF3digo"),pacienteNome:t("Paciente Nome"),convenioCodigo:t("Conv\xEAnio C\xF3digo"),convenioDescricao:t("Conv\xEAnio Descri\xE7\xE3o"),valorTotalPago:s("Valor Total Pago ao Profissional"),valorTotalComTaxas:s("Valor Total Pago + Taxas Adm."),dtEntrada:t("Dt. Entrada")}}mapOrcamento(e,a){let t=u=>a[e.indexOf(u)]||"",s=u=>parseFloat(t(u).replace(",","."))||0;return{orcamento:t("Or\xE7amento"),pacienteCodigo:t("Paciente C\xF3digo"),pacienteNome:t("Paciente Nome"),convenioCodigo:t("Conv\xEAnio C\xF3digo"),convenioDescricao:t("Conv\xEAnio Descri\xE7\xE3o"),profissaoCodigo:t("Profiss\xE3o C\xF3digo"),profissaoDescricao:t("Profiss\xE3o Descri\xE7\xE3o"),procedimento:t("prc_nom"),quantidade:s("Quantidade"),valorTotal:s("Vlr.Total"),custoTotal:s("CustoTotal")}}mapContas(e,a){let t=u=>a[e.indexOf(u)]||"",s=u=>parseFloat(t(u).replace(",","."))||0;return{conta:t("Conta"),orcamento:t("Or\xE7amento"),pacienteCodigo:t("Paciente C\xF3digo"),pacienteNome:t("Paciente Nome"),convenioCodigo:t("Conv\xEAnio C\xF3digo"),convenioDescricao:t("Conv\xEAnio Descri\xE7\xE3o"),profissaoCodigo:t("Profiss\xE3o C\xF3digo"),profissaoDescricao:t("Profiss\xE3o Descri\xE7\xE3o"),procedimento:t("prc_nom"),quantidade:s("Quantidade"),valorTotal:s("Vlr.Total"),custoTotal:s("CustoTotal")}}a1tualizarVisao(){}atualizarVisao(){if(this.remuneracaoData.length===0)return;let e=this.agruparDados(this.remuneracaoData);this.dadosAgrupados=Object.keys(e).map(a=>{let t=e[a],s=t.remuneracao.reduce((_,y)=>_+y.valorTotalPago,0),u=t.orcamentos.reduce((_,y)=>_+y.valorTotal,0),g=t.contas.reduce((_,y)=>_+y.valorTotal,0),A=t.orcamentos.reduce((_,y)=>_+y.custoTotal,0)+t.contas.reduce((_,y)=>_+y.custoTotal,0),V=g-A,Y=g>0?V/g:0,T={pacientes:new Set,convenios:new Set,profissionais:new Set,orcamentos:new Set,contas:new Set};return t.remuneracao.forEach(_=>{T.pacientes.add(`${_.pacienteCodigo} - ${_.pacienteNome}`),T.convenios.add(`${_.convenioCodigo} - ${_.convenioDescricao}`),T.profissionais.add(`${_.profissionalCodigo} - ${_.profissionalNome}`)}),t.orcamentos.forEach(_=>{T.orcamentos.add(_.orcamento)}),t.contas.forEach(_=>{T.contas.add(_.conta)}),{chave:a,descricao:this.getDescricaoGrupo(t),totalPago:s,totalOrcado:u,totalFaturado:g,custoTotal:A,margem:Y,lucroBruto:V,detalhes:t,mostrarDetalhes:!1,referencias:T}}),this.dadosAgrupados.sort((a,t)=>{switch(this.ordenacao){case"totalPago":return t.totalPago-a.totalPago;case"totalFaturado":return t.totalFaturado-a.totalFaturado;case"margem":return t.margem-a.margem;case"lucroBruto":return t.lucroBruto-a.lucroBruto;default:return t.totalPago-a.totalPago}}),this.resumoGeral={totalPago:this.dadosAgrupados.reduce((a,t)=>a+t.totalPago,0),totalOrcado:this.dadosAgrupados.reduce((a,t)=>a+t.totalOrcado,0),totalFaturado:this.dadosAgrupados.reduce((a,t)=>a+t.totalFaturado,0),custoTotal:this.dadosAgrupados.reduce((a,t)=>a+t.custoTotal,0),margem:0,lucroBruto:0},this.resumoGeral.lucroBruto=this.resumoGeral.totalFaturado-this.resumoGeral.custoTotal,this.resumoGeral.margem=this.resumoGeral.totalFaturado>0?this.resumoGeral.lucroBruto/this.resumoGeral.totalFaturado:0}expandirTodos(){this.dadosAgrupados.forEach(e=>{e.mostrarDetalhes=!0})}recolherTodos(){this.dadosAgrupados.forEach(e=>{e.mostrarDetalhes=!1})}agruparDados(e){let a={};return e.forEach(t=>{let s=this.getChaveAgrupamento(t);a[s]||(a[s]={remuneracao:[],orcamentos:[],contas:[],info:t}),a[s].remuneracao.push(t)}),this.orcamentoData.forEach(t=>{Object.keys(a).forEach(s=>{a[s].remuneracao.some(A=>this.isRelacionadoFlexivel(A,t))&&a[s].orcamentos.push(t)})}),this.contasData.forEach(t=>{Object.keys(a).forEach(s=>{a[s].remuneracao.some(A=>this.isRelacionadoFlexivel(A,t))&&a[s].contas.push(t)})}),a}isRelacionadoFlexivel(e,a){let t=e.pacienteCodigo===a.pacienteCodigo,s=e.profissaoCodigo===a.profissaoCodigo;return this.tipoVisao==="profissional"?t&&e.convenioCodigo===a.convenioCodigo&&e.profissionalCodigo===a.profissionalCodigo:t&&s}a1gruparDados(e){let a={};return e.forEach(t=>{let s=this.getChaveAgrupamento(t);a[s]||(a[s]={remuneracao:[],orcamentos:[],contas:[],info:t}),a[s].remuneracao.push(t)}),this.orcamentoData.forEach(t=>{Object.keys(a).forEach(s=>{this.isRelacionado(a[s].info,t)&&a[s].orcamentos.push(t)})}),this.contasData.forEach(t=>{Object.keys(a).forEach(s=>{this.isRelacionado(a[s].info,t)&&a[s].contas.push(t)})}),a}getChaveAgrupamento(e){switch(this.tipoVisao){case"profissional":return`${e.profissionalCodigo} - ${e.profissionalNome}`;case"profissao":return`${e.profissaoCodigo} - ${e.profissaoDescricao}`;case"convenio":return`${e.convenioCodigo} - ${e.convenioDescricao}`;case"paciente":return`${e.pacienteCodigo} - ${e.pacienteNome}`;default:return e.profissionalNome}}getDescricaoGrupo(e){let a=e.info;switch(this.tipoVisao){case"profissional":return a.profissaoDescricao;case"profissao":return`${e.remuneracao.length} profissionais`;case"convenio":return`${e.remuneracao.length} atendimentos`;case"paciente":return a.convenioDescricao;default:return""}}isRelacionado(e,a){return e.pacienteCodigo===a.pacienteCodigo&&e.convenioCodigo===a.convenioCodigo&&e.profissaoCodigo===a.profissaoCodigo}getTituloVisao(){return{profissional:"Por Profissional",profissao:"Por Profiss\xE3o",convenio:"Por Conv\xEAnio",paciente:"Por Paciente"}[this.tipoVisao]}getColunaAgrupamento(){return{profissional:"Profissional",profissao:"Profiss\xE3o",convenio:"Conv\xEAnio",paciente:"Paciente"}[this.tipoVisao]}toggleDetalhes(e){this.dadosAgrupados[e].mostrarDetalhes=!this.dadosAgrupados[e].mostrarDetalhes}exportarDados(){let e=this.gerarCSV(),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");if(t.download!==void 0){let s=URL.createObjectURL(a);t.setAttribute("href",s),t.setAttribute("download",`analise-remuneracao-${this.tipoVisao}-${new Date().toISOString().slice(0,10)}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}gerarCSV(){let e=[this.getColunaAgrupamento(),"Descri\xE7\xE3o","Total Pago","Total Or\xE7ado","Total Faturado","Custo Total","Margem %"],a=this.dadosAgrupados.map(t=>[t.chave,t.descricao,t.totalPago.toFixed(2),t.totalOrcado.toFixed(2),t.totalFaturado.toFixed(2),t.custoTotal.toFixed(2),(t.margem*100).toFixed(1)]);return[e,...a].map(t=>t.map(s=>`"${s}"`).join(",")).join(`
`)}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=O({type:l,selectors:[["app-remuneracao-analise"]],decls:40,vars:6,consts:[[1,"container-fluid","p-4"],[1,"mb-4"],[1,"card","mb-4"],[1,"card-header"],[1,"fas","fa-upload"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"upload-area"],[1,"form-label","fw-bold","text-danger"],[1,"fas","fa-money-bill-wave"],["type","file","accept",".txt,.csv",1,"form-control",3,"change"],[1,"mt-2"],[1,"badge","bg-danger"],[1,"form-label","fw-bold","text-info"],[1,"fas","fa-calculator"],[1,"badge","bg-info"],[1,"form-label","fw-bold","text-success"],[1,"fas","fa-file-invoice-dollar"],[1,"badge","bg-success"],["class","card mb-4",4,"ngIf"],["class","card",4,"ngIf"],[1,"fas","fa-filter"],[1,"form-label","fw-bold"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value","profissional"],["value","profissao"],["value","convenio"],["value","paciente"],[1,"col-md-3"],["value","resumido"],["value","detalhado"],["value","completo"],["value","totalPago"],["value","totalFaturado"],["value","margem"],["value","lucroBruto"],[1,"col-md-2"],[1,"form-label"],[1,"d-grid"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-sync-alt"],[1,"row","mt-3"],[1,"col-md-12"],[1,"d-flex","gap-2"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-download"],["class","btn btn-info btn-sm",3,"click",4,"ngIf"],["class","btn btn-secondary btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-info","btn-sm",3,"click"],[1,"fas","fa-expand-arrows-alt"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"fas","fa-compress-arrows-alt"],[1,"fas","fa-chart-pie"],[1,"row","text-center"],[1,"metric-card","bg-danger-subtle"],[1,"text-danger"],[1,"fw-bold"],[1,"mt-1"],[1,"text-muted"],[1,"metric-card","bg-info-subtle"],[1,"text-info"],[1,"metric-card","bg-success-subtle"],[1,"text-success"],[1,"metric-card","bg-warning-subtle"],[1,"text-warning"],[1,"metric-card"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"fas","fa-table"],[1,"badge","bg-primary"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","mb-0"],[1,"table-dark","sticky-top"],[2,"width","25%"],[1,"text-end",2,"width","12%"],[1,"text-end",2,"width","10%"],["class","text-center","style","width: 5%",4,"ngIf"],[1,"text-center",2,"width","5%"],["class","mt-1",4,"ngIf"],[1,"text-end","text-danger","fw-bold"],[1,"text-end","text-info"],[1,"text-end","text-success","fw-bold"],[1,"text-end","text-warning"],[1,"text-end","fw-bold"],["class","text-center",4,"ngIf"],["class","table-light",4,"ngIf"],["title","Pacientes",1,"badge","bg-secondary","me-1"],["title","Conv\xEAnios",1,"badge","bg-info","me-1"],["class","badge bg-success me-1","title","Or\xE7amentos",4,"ngIf"],["class","badge bg-warning","title","Contas",4,"ngIf"],["title","Or\xE7amentos",1,"badge","bg-success","me-1"],["title","Contas",1,"badge","bg-warning"],[1,"text-center"],[1,"btn","btn-sm",3,"click"],[1,"table-light"],[1,"p-4"],[1,"row","mb-3"],[1,"text-primary"],[1,"fas","fa-link"],[1,"row"],[1,"list-unstyled","mt-1",2,"font-size","0.85em"],[4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[4,"ngIf"],[1,"table-responsive",2,"max-height","200px"],[1,"table","table-sm","table-bordered"],[1,"text-end"]],template:function(a,t){a&1&&(n(0,"div",0)(1,"h2",1),o(2,"An\xE1lise de Remunera\xE7\xE3o Profissional"),i(),n(3,"div",2)(4,"div",3)(5,"h5"),f(6,"i",4),o(7," Upload de Dados"),i()(),n(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),f(13,"i",10),o(14," Remunera\xE7\xE3o Profissionais "),i(),n(15,"input",11),D("change",function(u){return t.uploadRemuneracao(u)}),i(),n(16,"div",12)(17,"span",13),o(18),i()()()(),n(19,"div",7)(20,"div",8)(21,"label",14),f(22,"i",15),o(23," Or\xE7amentos "),i(),n(24,"input",11),D("change",function(u){return t.uploadOrcamento(u)}),i(),n(25,"div",12)(26,"span",16),o(27),i()()()(),n(28,"div",7)(29,"div",8)(30,"label",17),f(31,"i",18),o(32," Contas (Faturado) "),i(),n(33,"input",11),D("change",function(u){return t.uploadContas(u)}),i(),n(34,"div",12)(35,"span",19),o(36),i()()()()()()(),h(37,te,56,5,"div",20)(38,ie,67,42,"div",20)(39,Ee,31,5,"div",21),i()),a&2&&(r(18),d("",t.remuneracaoData.length," registros"),r(9),d("",t.orcamentoData.length," registros"),r(9),d("",t.contasData.length," registros"),r(),p("ngIf",t.remuneracaoData.length>0),r(),p("ngIf",t.resumoGeral),r(),p("ngIf",t.dadosAgrupados.length>0))},dependencies:[q,L,N,j,W,G,X,J,K,H,U,Q],styles:[".container-fluid[_ngcontent-%COMP%]{max-width:1600px}.card[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 4px 6px #0000001a;border:1px solid #e3e6f0}.upload-area[_ngcontent-%COMP%]{padding:1rem;border:2px dashed #dee2e6;border-radius:8px;transition:border-color .3s}.upload-area[_ngcontent-%COMP%]:hover{border-color:#007bff}.metric-card[_ngcontent-%COMP%]{padding:1rem;border-radius:8px;margin:.25rem;min-height:100px;display:flex;flex-direction:column;justify-content:center}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap;font-weight:600;font-size:.85em}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.sticky-top[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}.table-responsive[_ngcontent-%COMP%]{max-height:70vh}.btn[_ngcontent-%COMP%]{border-radius:6px}.badge[_ngcontent-%COMP%]{font-size:.7em}.bg-danger-subtle[_ngcontent-%COMP%]{background-color:#f8d7da}.bg-info-subtle[_ngcontent-%COMP%]{background-color:#d1ecf1}.bg-success-subtle[_ngcontent-%COMP%]{background-color:#d1e7dd}.bg-warning-subtle[_ngcontent-%COMP%]{background-color:#fff3cd}.bg-secondary-subtle[_ngcontent-%COMP%]{background-color:#e2e3e5}"]})}return l})();export{Pe as RemuneracaoAnaliseComponent};
