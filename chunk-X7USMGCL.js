import{c as F,f as W,i as Y,o as X,p as N,q as Q,t as U}from"./chunk-OVH4RFKH.js";import{k as P,l as O,w as L}from"./chunk-HOG6MQQB.js";import{Ab as T,Bb as g,Ca as m,Kb as o,Lb as s,Mb as B,Qb as x,Rc as A,Vb as p,Wb as f,ab as h,ac as k,bc as M,cc as R,g as C,gc as u,ic as I,lb as V,mc as _,nc as b,oa as l,oc as v,pa as c,qa as E,ra as S,rb as y,zb as w}from"./chunk-5HUFPCHR.js";var q=["canvas"],G=["textInput"];function H(d,D){if(d&1){let e=x();o(0,"button",35),p("click",function(){let t=l(e).$implicit,n=f();return c(n.selectColor(t))}),s()}if(d&2){let e=D.$implicit,i=f();T("background-color",e),g("border-gray-800",i.selectedColor()===e)("border-gray-300",i.selectedColor()!==e)}}function z(d,D){if(d&1){let e=x();o(0,"input",36,1),v("ngModelChange",function(t){l(e);let n=f();return b(n.currentText,t)||(n.currentText=t),c(t)}),p("keyup.enter",function(){l(e);let t=f();return c(t.confirmText())})("blur",function(){l(e);let t=f();return c(t.confirmText())}),s()}if(d&2){let e=f();T("left",e.textInputPosition().x,"px")("top",e.textInputPosition().y,"px"),_("ngModel",e.currentText)}}var oe=(()=>{class d{canvasRef;textInputRef;isModalOpen=m(!1);isCapturing=m(!1);selectedTool=m("circle");selectedColor=m("#ff0000");showTextInput=m(!1);textInputPosition=m({x:0,y:0});reportType="BUG";description="";currentText="";ctx;isDrawing=!1;startX=0;startY=0;screenshot="";annotations=[];currentAnnotation=null;availableColors=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ff8800","#8800ff"];canSubmit=A(()=>this.reportType&&this.description.trim().length>0&&this.screenshot);openModal(){return C(this,null,function*(){this.isCapturing.set(!0);try{yield this.captureScreen(),this.isModalOpen.set(!0),setTimeout(()=>this.setupCanvas(),100)}catch(e){console.error("Erro ao capturar tela:",e),alert("Erro ao capturar a tela. Verifique as permiss\xF5es do navegador.")}finally{this.isCapturing.set(!1)}})}closeModal(){this.isModalOpen.set(!1),this.resetForm()}captureScreen(){return C(this,null,function*(){if(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)throw new Error("Captura de tela n\xE3o suportada neste navegador");try{let e=yield navigator.mediaDevices.getDisplayMedia({video:!0}),i=document.createElement("video");return i.srcObject=e,i.play(),new Promise((t,n)=>{i.onloadedmetadata=()=>{let r=document.createElement("canvas");r.width=i.videoWidth,r.height=i.videoHeight,r.getContext("2d").drawImage(i,0,0),this.screenshot=r.toDataURL("image/png"),e.getTracks().forEach(j=>j.stop()),t()},i.onerror=n})}catch{throw new Error("Usu\xE1rio cancelou a captura ou erro ao acessar a tela")}})}setupCanvas(){let e=this.canvasRef.nativeElement;this.ctx=e.getContext("2d");let i=new Image;i.onload=()=>{let n=e.parentElement.getBoundingClientRect();e.width=n.width,e.height=n.height,this.ctx.drawImage(i,0,0,e.width,e.height),this.redrawAnnotations()},i.src=this.screenshot}selectTool(e){this.selectedTool.set(e),this.showTextInput.set(!1)}selectColor(e){this.selectedColor.set(e)}startDrawing(e){if(this.selectedTool()==="text")return;let i=this.canvasRef.nativeElement.getBoundingClientRect();this.startX=e.clientX-i.left,this.startY=e.clientY-i.top,this.isDrawing=!0,this.currentAnnotation={type:this.selectedTool(),x:this.startX,y:this.startY,color:this.selectedColor(),id:Date.now().toString()}}draw(e){if(!this.isDrawing||!this.currentAnnotation)return;let i=this.canvasRef.nativeElement.getBoundingClientRect(),t=e.clientX-i.left,n=e.clientY-i.top;switch(this.redrawCanvas(),this.ctx.strokeStyle=this.currentAnnotation.color,this.ctx.lineWidth=2,this.ctx.setLineDash([]),this.currentAnnotation.type){case"rectangle":this.currentAnnotation.width=t-this.startX,this.currentAnnotation.height=n-this.startY,this.ctx.strokeRect(this.startX,this.startY,this.currentAnnotation.width,this.currentAnnotation.height);break;case"circle":let r=Math.sqrt(Math.pow(t-this.startX,2)+Math.pow(n-this.startY,2));this.currentAnnotation.width=r*2,this.currentAnnotation.height=r*2,this.ctx.beginPath(),this.ctx.arc(this.startX,this.startY,r,0,2*Math.PI),this.ctx.stroke();break;case"arrow":this.currentAnnotation.endX=t,this.currentAnnotation.endY=n,this.drawArrow(this.startX,this.startY,t,n);break}}stopDrawing(e){!this.isDrawing||!this.currentAnnotation||(this.isDrawing=!1,this.annotations.push(this.currentAnnotation),this.currentAnnotation=null)}addText(e){if(this.selectedTool()!=="text")return;let i=this.canvasRef.nativeElement.getBoundingClientRect(),t=e.clientX-i.left,n=e.clientY-i.top;this.textInputPosition.set({x:t,y:n}),this.showTextInput.set(!0),this.currentText="",setTimeout(()=>{this.textInputRef?.nativeElement?.focus()},100)}confirmText(){if(!this.currentText.trim()){this.showTextInput.set(!1);return}let e={type:"text",x:this.textInputPosition().x,y:this.textInputPosition().y,text:this.currentText,color:this.selectedColor(),id:Date.now().toString()};this.annotations.push(e),this.showTextInput.set(!1),this.currentText="",this.redrawAnnotations()}drawArrow(e,i,t,n){let a=Math.atan2(n-i,t-e);this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(t,n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t,n),this.ctx.lineTo(t-10*Math.cos(a-Math.PI/6),n-10*Math.sin(a-Math.PI/6)),this.ctx.moveTo(t,n),this.ctx.lineTo(t-10*Math.cos(a+Math.PI/6),n-10*Math.sin(a+Math.PI/6)),this.ctx.stroke()}redrawCanvas(){let e=this.canvasRef.nativeElement,i=new Image;i.onload=()=>{this.ctx.clearRect(0,0,e.width,e.height),this.ctx.drawImage(i,0,0,e.width,e.height),this.redrawAnnotations()},i.src=this.screenshot}redrawAnnotations(){this.annotations.forEach(e=>{switch(this.ctx.strokeStyle=e.color,this.ctx.fillStyle=e.color,this.ctx.lineWidth=2,this.ctx.setLineDash([]),e.type){case"rectangle":this.ctx.strokeRect(e.x,e.y,e.width,e.height);break;case"circle":let i=e.width/2;this.ctx.beginPath(),this.ctx.arc(e.x,e.y,i,0,2*Math.PI),this.ctx.stroke();break;case"arrow":this.drawArrow(e.x,e.y,e.endX,e.endY);break;case"text":this.ctx.font="16px Arial",this.ctx.fillText(e.text,e.x,e.y);break}})}clearAnnotations(){this.annotations=[],this.redrawCanvas()}submitReport(){if(!this.canSubmit())return;let e={type:this.reportType,description:this.description,screenshot:this.screenshot,annotations:this.annotations,timestamp:new Date};console.log("Report enviado:",e),alert("Report enviado com sucesso!"),this.closeModal()}resetForm(){this.reportType="BUG",this.description="",this.annotations=[],this.screenshot="",this.showTextInput.set(!1),this.selectedTool.set("circle"),this.selectedColor.set("#ff0000")}static \u0275fac=function(i){return new(i||d)};static \u0275cmp=V({type:d,selectors:[["app-bug-report"]],viewQuery:function(i,t){if(i&1&&(k(q,5),k(G,5)),i&2){let n;M(n=R())&&(t.canvasRef=n.first),M(n=R())&&(t.textInputRef=n.first)}},decls:56,vars:17,consts:[["canvas",""],["textInput",""],[1,"btn","btn-error","btn-sm",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"],["id","bug-report-modal",1,"modal"],[1,"modal-box","w-11/12","max-w-6xl","h-5/6","max-h-screen","flex","flex-col"],[1,"flex","justify-between","items-center","mb-4"],[1,"font-bold","text-lg"],[1,"btn","btn-sm","btn-circle","btn-ghost",3,"click"],[1,"flex-1","flex","gap-4","overflow-hidden"],[1,"flex-1","flex","flex-col"],[1,"flex","gap-2","mb-2","flex-wrap"],[1,"btn-group"],[1,"btn","btn-sm",3,"click"],[1,"flex","gap-1"],["class","w-8 h-8 rounded border-2",3,"background-color","border-gray-800","border-gray-300","click",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-warning",3,"click"],[1,"flex-1","border","rounded-lg","overflow-hidden","bg-gray-100","relative"],[1,"cursor-crosshair","w-full","h-full",3,"mousedown","mousemove","mouseup","click"],["type","text","class","absolute border-2 border-blue-500 bg-white px-2 py-1 text-sm","placeholder","Digite o texto...",3,"left","top","ngModel","ngModelChange","keyup.enter","blur",4,"ngIf"],[1,"w-80","flex","flex-col"],[1,"form-control","mb-4"],[1,"label"],[1,"label-text","font-semibold"],[1,"select","select-bordered","w-full",3,"ngModelChange","ngModel"],["value","BUG"],["value","MELHORIA"],["value","AJUSTES"],["value","CORRECAO"],[1,"form-control","mb-4","flex-1"],["placeholder","Descreva detalhadamente o problema ou sugest\xE3o...",1,"textarea","textarea-bordered","h-full","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"btn","btn-primary","flex-1",3,"click","disabled"],[1,"btn","btn-ghost",3,"click"],[1,"w-8","h-8","rounded","border-2",3,"click"],["type","text","placeholder","Digite o texto...",1,"absolute","border-2","border-blue-500","bg-white","px-2","py-1","text-sm",3,"ngModelChange","keyup.enter","blur","ngModel"]],template:function(i,t){if(i&1){let n=x();o(0,"button",2),p("click",function(){return l(n),c(t.openModal())}),E(),o(1,"svg",3),B(2,"path",4),s(),u(3),s(),S(),o(4,"div",5)(5,"div",6)(6,"div",7)(7,"h3",8),u(8,"Reportar Bug/Melhoria"),s(),o(9,"button",9),p("click",function(){return l(n),c(t.closeModal())}),u(10,"\u2715"),s()(),o(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",13)(15,"button",14),p("click",function(){return l(n),c(t.selectTool("circle"))}),u(16," \u2B55 C\xEDrculo "),s(),o(17,"button",14),p("click",function(){return l(n),c(t.selectTool("rectangle"))}),u(18," \u2B1C Ret\xE2ngulo "),s(),o(19,"button",14),p("click",function(){return l(n),c(t.selectTool("arrow"))}),u(20," \u27A1\uFE0F Seta "),s(),o(21,"button",14),p("click",function(){return l(n),c(t.selectTool("text"))}),u(22," \u{1F4DD} Texto "),s()(),o(23,"div",15),y(24,H,1,6,"button",16),s(),o(25,"button",17),p("click",function(){return l(n),c(t.clearAnnotations())}),u(26,"\u{1F5D1}\uFE0F Limpar"),s()(),o(27,"div",18)(28,"canvas",19,0),p("mousedown",function(a){return l(n),c(t.startDrawing(a))})("mousemove",function(a){return l(n),c(t.draw(a))})("mouseup",function(a){return l(n),c(t.stopDrawing(a))})("click",function(a){return l(n),c(t.addText(a))}),s(),y(30,z,2,5,"input",20),s()(),o(31,"div",21)(32,"div",22)(33,"label",23)(34,"span",24),u(35,"Tipo de Report"),s()(),o(36,"select",25),v("ngModelChange",function(a){return l(n),b(t.reportType,a)||(t.reportType=a),c(a)}),o(37,"option",26),u(38,"\u{1F41B} Bug"),s(),o(39,"option",27),u(40,"\u2728 Melhoria"),s(),o(41,"option",28),u(42,"\u{1F527} Ajustes"),s(),o(43,"option",29),u(44,"\u{1F528} Corre\xE7\xE3o"),s()()(),o(45,"div",30)(46,"label",23)(47,"span",24),u(48,"Descri\xE7\xE3o"),s()(),o(49,"textarea",31),v("ngModelChange",function(a){return l(n),b(t.description,a)||(t.description=a),c(a)}),u(50,"              "),s()(),o(51,"div",32)(52,"button",33),p("click",function(){return l(n),c(t.submitReport())}),u(53," \u{1F4E4} Submeter "),s(),o(54,"button",34),p("click",function(){return l(n),c(t.closeModal())}),u(55," Cancelar "),s()()()()()()}i&2&&(w("disabled",t.isCapturing()),h(3),I(" ",t.isCapturing()?"Capturando...":"Reportar Bug"," "),h(),g("modal-open",t.isModalOpen()),h(11),g("btn-active",t.selectedTool()==="circle"),h(2),g("btn-active",t.selectedTool()==="rectangle"),h(2),g("btn-active",t.selectedTool()==="arrow"),h(2),g("btn-active",t.selectedTool()==="text"),h(3),w("ngForOf",t.availableColors),h(6),w("ngIf",t.showTextInput()),h(6),_("ngModel",t.reportType),h(13),_("ngModel",t.description),h(3),w("disabled",!t.canSubmit()))},dependencies:[L,P,O,U,N,Q,F,X,W,Y],styles:[".modal-box[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_modalSlideIn .3s ease-out}@keyframes _ngcontent-%COMP%_modalSlideIn{0%{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}canvas[_ngcontent-%COMP%]{display:block}"]})}return d})();export{oe as BugReportComponent};
