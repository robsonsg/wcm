import{C as I,I as J,M as W,T as Y,V as Z,Wa as O,X as S,Y as Q,Z as X,a as d,aa as y,b as L,ba as ee,bb as te,c as K,da as h,db as ne,fa as g,ga as A,ha as v,j as B,m as G,ma as N,n as q,p as z,q as j,r as M,va as R,w as b,x as U,xc as F}from"./chunk-27GLVKKX.js";function E(t){t||(N(E),t=A(R));let a=new B(e=>t.onDestroy(e.next.bind(e)));return e=>e.pipe(Q(a))}var k=class{translations;constructor(a){this.translations=a}getTranslation(a){return M(this.translations.get(a)||{})}},ie=new h("");function $(t,a){return t&&(Object.prototype.hasOwnProperty.call(t,a)?t[a]:a.split(".").reduce((e,n)=>e?.[n],t))}function ye(t,a,e){t=d({},t);let n=a.split("."),r=n.length-1;return n.reduce((s,i,o)=>(o===r?s[i]=e:s[i]=Array.isArray(s[i])?s[i].slice():d({},s[i]),s&&s[i]),t),t}function ae(t){return t?Array.isArray(t)?t.length:D(t)?Object.keys(t).length:t?t.length:0:0}function me(t){return ae(t)===0}function Te(t){return typeof t=="function"}function w(t){return typeof t=="string"}function D(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function oe(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,(a,e)=>e==0?a.toLowerCase():a.toUpperCase()).replace(/\s+|_|-|\//g,"")}function _(t){return t==null}function re(t){return _(t)===!1}function ce(t){return t&&typeof t.scope=="string"}function Se(t){return t&&D(t.loader)}function se(t){let a={};function e(n,r){if(n===null)a[r]=null;else if(D(n))for(let[s,i]of Object.entries(n))e(i,r?`${r}.${s}`:s);else a[r]=n}return e(t,""),a}function Ae(t){let a={};for(let[e,n]of Object.entries(t)){let r=e.split("."),s=a;r.forEach((i,o)=>{o===r.length-1?s[i]=n:(s[i]??={},s=s[i])})}return a}var T=new h("",{providedIn:"root",factory:()=>m}),m={defaultLang:"en",reRenderOnLangChange:!1,prodMode:!1,failedRetries:2,fallbackLang:[],availableLangs:[],missingHandler:{logMissingKey:!0,useFallbackTranslation:!1,allowEmpty:!1},flatten:{aot:!1},interpolation:["{{","}}"],scopes:{keepCasing:!1}};function Oe(t={}){return L(d(d({},m),t),{missingHandler:d(d({},m.missingHandler),t.missingHandler),flatten:d(d({},m.flatten),t.flatten),scopes:d(d({},m.scopes),t.scopes)})}var le=new h(""),we=(()=>{class t{config=A(T,{optional:!0})??m;get interpolationMatcher(){return Ce(this.config)}transpile({value:e,params:n={},translation:r,key:s}){if(w(e)){let i,o=e;for(;(i=this.interpolationMatcher.exec(o))!==null;){let[l,c]=i;o=o.replace(l,()=>{let u=c.trim(),f=$(n,u);return re(f)?f:re(r[u])?this.transpile({params:n,translation:r,key:s,value:r[u]}):""})}return o}else n&&(D(e)?e=this.handleObject({value:e,params:n,translation:r,key:s}):Array.isArray(e)&&(e=this.handleArray({value:e,params:n,translation:r,key:s})));return e}handleObject({value:e,params:n={},translation:r,key:s}){let i=e;return Object.keys(n).forEach(o=>{let l=this.transpile({value:$(i,o),params:$(n,o),translation:r,key:s});i=ye(i,o,l)}),i}handleArray(r){var s=r,{value:e}=s,n=K(s,["value"]);return e.map(i=>this.transpile(d({value:i},n)))}static \u0275fac=function(n){return new(n||t)};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})();function Ce(t){let[a,e]=t.interpolation;return new RegExp(`${a}([^${a}${e}]*?)${e}`,"g")}var ue=new h(""),Me=(()=>{class t{handle(e,n){if(n.missingHandler.logMissingKey&&!n.prodMode){let r=`Missing translation for '${e}'`;console.warn(`%c ${r}`,"font-size: 12px; color: red")}return e}static \u0275fac=function(n){return new(n||t)};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})(),de=new h(""),Re=(()=>{class t{preSaveTranslation(e){return e}preSaveTranslationKey(e,n){return n}static \u0275fac=function(n){return new(n||t)};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})(),fe=new h(""),De=(()=>{class t{userConfig;constructor(e){this.userConfig=e}getNextLangs(){let e=this.userConfig.fallbackLang;if(!e)throw new Error("When using the default fallback, a fallback language must be provided in the config!");return Array.isArray(e)?e:[e]}static \u0275fac=function(n){return new(n||t)(g(T))};static \u0275prov=y({token:t,factory:t.\u0275fac})}return t})();function C(t){if(!t)return"";let a=t.split("/");return a.pop(),a.join("/")}function p(t){return t?t.split("/").pop():""}function P(t,a,e="|"){if(w(t)){let n=t.split(e),r=n.pop();return r===a?[!0,n.toString()]:[!1,r]}return[!1,""]}function je(t,a){let[e]=P(a,"static");return e?!1:!!t.config.reRenderOnLangChange}function Ie(t){return t?a=>a:W(1)}function Ne(t,a){return Object.keys(t).reduce((e,n)=>(e[`${a}/${n}`]=t[n],e),{})}function he(t,a){return Se(t)?Ne(t.loader,a):void 0}function x(t){return{scope:C(t)||null,langName:p(t)}}function ge(t){let{path:a,inlineLoader:e,mainLoader:n,data:r}=t;if(e){let s=e[a];if(Te(s)===!1)throw`You're using an inline loader but didn't provide a loader for ${a}`;return e[a]().then(i=>i.default?i.default:i)}return n.getTranslation(a,r)}function Fe({mainLoader:t,path:a,data:e,fallbackPath:n,inlineLoader:r}){return(n?[a,n]:[a]).map(i=>{let o=ge({path:i,mainLoader:t,inlineLoader:r,data:e});return j(o).pipe(b(l=>({translation:l,lang:i})))})}var Ee;var $e=(()=>{class t{loader;parser;missingHandler;interceptor;fallbackStrategy;langChanges$;translations=new Map;cache=new Map;firstFallbackLang;defaultLang="";availableLangs=[];isResolvedMissingOnce=!1;lang;failedLangs=new Set;events=new G;events$=this.events.asObservable();config;destroyRef=A(R);constructor(e,n,r,s,i,o){this.loader=e,this.parser=n,this.missingHandler=r,this.interceptor=s,this.fallbackStrategy=o,this.loader||(this.loader=new k(this.translations)),Ee=this,this.config=JSON.parse(JSON.stringify(i)),this.setAvailableLangs(this.config.availableLangs||[]),this.setFallbackLangForMissingTranslation(this.config),this.setDefaultLang(this.config.defaultLang),this.lang=new q(this.getDefaultLang()),this.langChanges$=this.lang.asObservable(),this.events$.subscribe(l=>{l.type==="translationLoadSuccess"&&l.wasFailure&&this.setActiveLang(l.payload.langName)}),this.destroyRef.onDestroy(()=>{this.lang.complete(),this.events.complete(),this.cache.clear()})}getDefaultLang(){return this.defaultLang}setDefaultLang(e){this.defaultLang=e}getActiveLang(){return this.lang.getValue()}setActiveLang(e){return this.parser.onLangChanged?.(e),this.lang.next(e),this.events.next({type:"langChanged",payload:x(e)}),this}setAvailableLangs(e){this.availableLangs=e}getAvailableLangs(){return this.availableLangs}load(e,n={}){let r=this.cache.get(e);if(r)return r;let s,i=this._isLangScoped(e),o;i&&(o=C(e));let l={path:e,mainLoader:this.loader,inlineLoader:n.inlineLoader,data:i?{scope:o}:void 0};if(this.useFallbackTranslation(e)){let u=i?`${o}/${this.firstFallbackLang}`:this.firstFallbackLang,f=Fe(L(d({},l),{fallbackPath:u}));s=I(f)}else{let u=ge(l);s=j(u)}let c=s.pipe(Y(this.config.failedRetries),X(u=>{if(Array.isArray(u)){u.forEach(f=>{this.handleSuccess(f.lang,f.translation),f.lang!==e&&this.cache.set(f.lang,M({}))});return}this.handleSuccess(e,u)}),J(u=>(this.config.prodMode||console.error(`Error while trying to load "${e}"`,u),this.handleFailure(e,n))),Z(1),E(this.destroyRef));return this.cache.set(e,c),c}translate(e,n={},r=this.getActiveLang()){if(!e)return e;let{scope:s,resolveLang:i}=this.resolveLangAndScope(r);if(Array.isArray(e))return e.map(c=>this.translate(s?`${s}.${c}`:c,n,i));e=s?`${s}.${e}`:e;let o=this.getTranslation(i),l=o[e];return l?this.parser.transpile({value:l,params:n,translation:o,key:e}):this._handleMissingKey(e,l,n)}selectTranslate(e,n,r,s=!1){let i,o=(c,u)=>this.load(c,u).pipe(b(()=>s?this.translateObject(e,n,c):this.translate(e,n,c)));if(_(r))return this.langChanges$.pipe(S(c=>o(c)));if(r=Array.isArray(r)?r[0]:r,ce(r)){let c=r;r=c.scope,i=he(c,c.scope)}if(r=r,this.isLang(r)||this.isScopeWithLang(r))return o(r);let l=r;return this.langChanges$.pipe(S(c=>o(`${l}/${c}`,{inlineLoader:i})))}isScopeWithLang(e){return this.isLang(p(e))}translateObject(e,n={},r=this.getActiveLang()){if(w(e)||Array.isArray(e)){let{resolveLang:i,scope:o}=this.resolveLangAndScope(r);if(Array.isArray(e))return e.map(u=>this.translateObject(o?`${o}.${u}`:u,n,i));let l=this.getTranslation(i);e=o?`${o}.${e}`:e;let c=Ae(this.getObjectByKey(l,e));return me(c)?this.translate(e,n,r):this.parser.transpile({value:c,params:n,translation:l,key:e})}let s=[];for(let[i,o]of this.getEntries(e))s.push(this.translateObject(i,o,r));return s}selectTranslateObject(e,n,r){if(w(e)||Array.isArray(e))return this.selectTranslate(e,n,r,!0);let[[s,i],...o]=this.getEntries(e);return this.selectTranslateObject(s,i,r).pipe(b(l=>{let c=[l];for(let[u,f]of o)c.push(this.translateObject(u,f,r));return c}))}getTranslation(e){if(e){if(this.isLang(e))return this.translations.get(e)||{};{let{scope:n,resolveLang:r}=this.resolveLangAndScope(e),s=this.translations.get(r)||{};return this.getObjectByKey(s,n)}}return this.translations}selectTranslation(e){let n=this.langChanges$;if(e){let r=p(e)!==e;this.isLang(e)||r?n=M(e):n=this.langChanges$.pipe(b(s=>`${e}/${s}`))}return n.pipe(S(r=>this.load(r).pipe(b(()=>this.getTranslation(r)))))}setTranslation(e,n=this.getActiveLang(),r={}){let i=d(d({},{merge:!0,emitChange:!0}),r),o=C(n),l=e;if(o){let ve=this.getMappedScope(o);l=se({[ve]:e})}let c=o?p(n):n,u=d(d({},i.merge&&this.getTranslation(c)),l),f=this.config.flatten.aot?u:se(u),pe=this.interceptor.preSaveTranslation(f,c);this.translations.set(c,pe),i.emitChange&&this.setActiveLang(this.getActiveLang())}setTranslationKey(e,n,r={}){let s=r.lang||this.getActiveLang(),i=this.interceptor.preSaveTranslationKey(e,n,s),o={[e]:i};this.setTranslation(o,s,L(d({},r),{merge:!0}))}setFallbackLangForMissingTranslation({fallbackLang:e}){let n=Array.isArray(e)?e[0]:e;e&&this.useFallbackTranslation(n)&&(this.firstFallbackLang=n)}_handleMissingKey(e,n,r){if(this.config.missingHandler.allowEmpty&&n==="")return"";if(!this.isResolvedMissingOnce&&this.useFallbackTranslation()){this.isResolvedMissingOnce=!0;let s=this.translate(e,r,this.firstFallbackLang);return this.isResolvedMissingOnce=!1,s}return this.missingHandler.handle(e,this.getMissingHandlerData(),r)}_isLangScoped(e){return this.getAvailableLangsIds().indexOf(e)===-1}isLang(e){return this.getAvailableLangsIds().indexOf(e)!==-1}_loadDependencies(e,n){let r=p(e);return this._isLangScoped(e)&&!this.isLoadedTranslation(r)?U([this.load(r),this.load(e,{inlineLoader:n})]):this.load(e,{inlineLoader:n})}_completeScopeWithLang(e){return this._isLangScoped(e)&&!this.isLang(p(e))?`${e}/${this.getActiveLang()}`:e}_setScopeAlias(e,n){this.config.scopeMapping||(this.config.scopeMapping={}),this.config.scopeMapping[e]=n}isLoadedTranslation(e){return ae(this.getTranslation(e))}getAvailableLangsIds(){let e=this.getAvailableLangs()[0];return w(e)?this.getAvailableLangs():this.getAvailableLangs().map(n=>n.id)}getMissingHandlerData(){return L(d({},this.config),{activeLang:this.getActiveLang(),availableLangs:this.availableLangs,defaultLang:this.defaultLang})}useFallbackTranslation(e){return this.config.missingHandler.useFallbackTranslation&&e!==this.firstFallbackLang}handleSuccess(e,n){this.setTranslation(n,e,{emitChange:!1}),this.events.next({wasFailure:!!this.failedLangs.size,type:"translationLoadSuccess",payload:x(e)}),this.failedLangs.forEach(r=>this.cache.delete(r)),this.failedLangs.clear()}handleFailure(e,n){_(n.failedCounter)&&(n.failedCounter=0,n.fallbackLangs||(n.fallbackLangs=this.fallbackStrategy.getNextLangs(e)));let r=e.split("/"),i=n.fallbackLangs[n.failedCounter];if(this.failedLangs.add(e),this.cache.has(i))return this.handleSuccess(i,this.getTranslation(i)),z;let o=i===r[r.length-1];if(!i||o){let c="Unable to load translation and all the fallback languages";throw r.length>1&&(c+=", did you misspelled the scope name?"),new Error(c)}let l=i;return r.length>1&&(r[r.length-1]=i,l=r.join("/")),n.failedCounter++,this.events.next({type:"translationLoadFailure",payload:x(e)}),this.load(l,n)}getMappedScope(e){let{scopeMapping:n={},scopes:r={keepCasing:!1}}=this.config;return n[e]||(r.keepCasing?e:oe(e))}resolveLangAndScope(e){let n=e,r;if(this._isLangScoped(e)){let s=p(e),i=this.isLang(s);n=i?s:this.getActiveLang(),r=this.getMappedScope(i?C(e):e)}return{scope:r,resolveLang:n}}getObjectByKey(e,n){let r={},s=`${n}.`;for(let i in e)i.startsWith(s)&&(r[i.replace(s,"")]=e[i]);return r}getEntries(e){return e instanceof Map?e.entries():Object.entries(e)}static \u0275fac=function(n){return new(n||t)(g(ie,8),g(le),g(ue),g(de),g(T),g(fe))};static \u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var xe=new h(""),Ft=new h(""),ke=new h(""),V=class{initialized=!1;resolve({inline:a,provider:e,active:n}){let r=n;if(this.initialized)return r=n,r;if(e){let[,s]=P(e,"static");r=s}if(a){let[,s]=P(a,"static");r=s}return this.initialized=!0,r}resolveLangBasedOnScope(a){return C(a)?p(a):a}resolveLangPath(a,e){return e?`${e}/${a}`:a}},H=class{service;constructor(a){this.service=a}resolve(a){let{inline:e,provider:n}=a;if(e)return e;if(n){if(ce(n)){let{scope:r,alias:s=this.service.config.scopes.keepCasing?r:oe(r)}=n;return this.service._setScopeAlias(r,s),r}return n}}};var Et=(()=>{class t{service;providerScope;providerLang;cdr;subscription=null;lastValue="";lastKey;path;langResolver=new V;scopeResolver;constructor(e,n,r,s){this.service=e,this.providerScope=n,this.providerLang=r,this.cdr=s,this.scopeResolver=new H(this.service)}transform(e,n,r){if(!e)return e;let s=n?`${e}${JSON.stringify(n)}`:e;if(s===this.lastKey)return this.lastValue;this.lastKey=s,this.subscription?.unsubscribe();let i=je(this.service,this.providerLang||r);return this.subscription=this.service.langChanges$.pipe(S(o=>{let l=this.langResolver.resolve({inline:r,provider:this.providerLang,active:o});return Array.isArray(this.providerScope)?I(this.providerScope.map(c=>this.resolveScope(l,c))):this.resolveScope(l,this.providerScope)}),Ie(i)).subscribe(()=>this.updateValue(e,n)),this.lastValue}ngOnDestroy(){this.subscription?.unsubscribe(),this.subscription=null}updateValue(e,n){let r=this.langResolver.resolveLangBasedOnScope(this.path);this.lastValue=this.service.translate(e,n,r),this.cdr.markForCheck()}resolveScope(e,n){let r=this.scopeResolver.resolve({inline:void 0,provider:n});this.path=this.langResolver.resolveLangPath(e,r);let s=he(n,r);return this.service._loadDependencies(this.path,s)}static \u0275fac=function(n){return new(n||t)(O($e,16),O(ke,24),O(xe,24),O(F,16))};static \u0275pipe=ne({name:"transloco",type:t,pure:!1})}return t})();var $t=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=te({type:t});static \u0275inj=ee({})}return t})();function xt(t){let a=[Ve(we),Ke(Me),Be(Re),He(De)];return t.config&&a.push(_e(t.config)),t.loader&&a.push(Pe(t.loader)),a}function _e(t){return v([{provide:T,useValue:Oe(t)}])}function Pe(t){return v([{provide:ie,useClass:t}])}function Ve(t){return v([{provide:le,useClass:t,deps:[T]}])}function He(t){return v([{provide:fe,useClass:t,deps:[T]}])}function Ke(t){return v([{provide:ue,useClass:t}])}function Be(t){return v([{provide:de,useClass:t}])}var kt=new h("TRANSLOCO_TEST_LANGS - Available testing languages"),_t=new h("TRANSLOCO_TEST_OPTIONS - Testing options");export{E as a,$e as b,Et as c,$t as d,xt as e};
