import{a as T}from"./chunk-5267M4YT.js";import{Ca as v,Ec as E,aa as A,fa as O,g as D}from"./chunk-27GLVKKX.js";var S=(()=>{class P{http;dadosRemuneracao=v([]);dadosOrcamentos=v([]);dadosContas=v([]);carregando=v(!1);erro=v(null);statusDados=E(()=>({remuneracao:this.dadosRemuneracao().length,orcamentos:this.dadosOrcamentos().length,contas:this.dadosContas().length}));temDados=E(()=>this.dadosRemuneracao().length>0||this.dadosOrcamentos().length>0||this.dadosContas().length>0);isCarregando=E(()=>this.carregando());erroAtual=E(()=>this.erro());remuneracaoMapping={profissionalCodigo:{headers:["Profissional Codigo"]},profissionalNome:{headers:["Profissional Nome"]},profissaoCodigo:{headers:["Profissao Codigo"]},profissaoDescricao:{headers:["Profissao Descricao"]},pacienteCodigo:{headers:["Paciente Codigo"]},pacienteNome:{headers:["Paciente Nome"]},convenioCodigo:{headers:["Convenio Codigo"]},convenioDescricao:{headers:["Convenio Descricao"]},cooperativaCodigo:{headers:["Cooperativa Codigo"]},cooperativaDescricao:{headers:["Cooperativa Descricao"]},dtEntrada:{headers:["Dt. Entrada"]},hrEntrada:{headers:["Hr. Entrada"]},dtSaida:{headers:["Dt. Saida"]},hrSaida:{headers:["Hr. Saida"]},totalHoras:{headers:["Total Horas"]},valorTotalPago:{headers:["Valor Total Pago ao Profissional"],type:"number"},ajudaCusto:{headers:["Ajuda de Custo"],type:"number"},valorComAjudaCusto:{headers:["Valor Total Pago ao Profissional + Ajuda de Custo"],type:"number"},coopTxAdm:{headers:["coop_tx_adm"],type:"number"},coopInss:{headers:["coop_inss"],type:"number"},coopIss:{headers:["coop_iss"],type:"number"},coopIrrf:{headers:["coop_irrf"],type:"number"},coopPis:{headers:["coop_pis"],type:"number"},coopCofins:{headers:["coop_cofins"],type:"number"},prcTabela:{headers:["prc_tabela"]},prcCodigo:{headers:["prc_codigo"]},prcDescricao:{headers:["prc_nom"]},prodQtdHora:{headers:["prod_qtd_hora"]}};orcamentoMapping={orcamento:{headers:["Orcamento"]},pacienteCodigo:{headers:["Paciente Codigo"]},pacienteNome:{headers:["Paciente Nome"]},convenioCodigo:{headers:["Convenio Codigo"]},convenioDescricao:{headers:["Convenio Descricao"]},profissaoCodigo:{headers:["Profissao Codigo"]},profissaoDescricao:{headers:["Profissao Descricao"]},quantidade:{headers:["Quantidade"],type:"number"},valorTotal:{headers:["Vlr.Total"],type:"number"},prcTabela:{headers:["prc_tabela"]},prcCodigo:{headers:["prc_codigo"]},prcDescricao:{headers:["prc_nom"]},prcTp:{headers:["prc_tP"]},prcQtdHr:{headers:["prc_qtd_hr"]}};contasMapping={conta:{headers:["Conta"]},orcamento:{headers:["Orcamento"]},pacienteCodigo:{headers:["Paciente Codigo"]},pacienteNome:{headers:["Paciente Nome"]},convenioCodigo:{headers:["Convenio Codigo"]},convenioDescricao:{headers:["Convenio Descricao"]},profissaoCodigo:{headers:["Profissao Codigo"]},profissaoDescricao:{headers:["Profissao Descricao"]},quantidade:{headers:["Quantidade"],type:"number"},valorTotal:{headers:["Vlr.Total"],type:"number"},prcTabela:{headers:["prc_tabela"]},prcCodigo:{headers:["prc_codigo"]},prcDescricao:{headers:["prc_nom"]},prcTp:{headers:["prc_tP"]},prcQtdHr:{headers:["prc_qtd_hr"]}};constructor(e){this.http=e}processarArquivo(e,s){return D(this,null,function*(){this.carregando.set(!0),this.erro.set(null);try{let o=yield this.lerArquivo(e),r=this.validarCabecalhos(o,s);if(!r.valido)return this.erro.set(r.erro||"Erro na valida\xE7\xE3o"),r;let a=this.processarConteudo(o,s);return this.atualizarDados(s,a),{valido:!0}}catch(o){let r=o instanceof Error?o.message:"Erro desconhecido";return this.erro.set(r),{valido:!1,erro:r}}finally{this.carregando.set(!1)}})}analisar(e={}){let{tipoVisao:s="profissional",ordenacao:o="totalPago",incluirAjudaCusto:r=!1}=e;try{let a=this.agruparDados(s,r);console.log("Dados agrupados:",a);let t=this.calcularEstatisticas(a,s,r);this.ordenarDados(t,o);let i=this.calcularResumoGeral(t,s,r),c={sucesso:!0,dadosAgrupados:t,resumoGeral:i,contadores:{remuneracao:this.dadosRemuneracao().length,orcamentos:this.dadosOrcamentos().length,contas:this.dadosContas().length}};return console.log("An\xE1lise conclu\xEDda:",c),c}catch(a){console.error("Erro na an\xE1lise:",a);let t=a instanceof Error?a.message:"Erro na an\xE1lise";throw this.erro.set(t),a}}resetarDados(){this.dadosRemuneracao.set([]),this.dadosOrcamentos.set([]),this.dadosContas.set([]),this.erro.set(null)}lerArquivo(e){return D(this,null,function*(){return new Promise((s,o)=>{let r=new FileReader;r.onload=()=>s(r.result),r.onerror=()=>o(new Error("Erro ao ler arquivo")),r.readAsText(e,"iso-8859-1")})})}validarCabecalhos(e,s){let o=e.replace(/\r/g,"").split(`
`).filter(c=>c.trim());if(o.length<1)return{valido:!1,erro:"Arquivo vazio ou sem conte\xFAdo v\xE1lido"};let a=this.parseTabLine(o[0]).map(c=>c.replace(/^"(.*)"$/,"$1").replace(/"/g,"").trim()),t=this.extrairCabecalhosDoMapping(s),i=[];return t.forEach(c=>{this.findHeader(a,[c])||i.push(c)}),i.length>0?{valido:!1,erro:"Colunas obrigat\xF3rias ausentes",sugestao:`Verifique se o arquivo cont\xE9m as seguintes colunas obrigat\xF3rias: ${i.join(", ")}`,detalhes:{cabecalhosFaltantes:i,cabecalhosEncontrados:a,totalRequeridos:t.length,totalEncontrados:a.length}}:{valido:!0,detalhes:{cabecalhosEncontrados:a,totalRequeridos:t.length,totalEncontrados:a.length}}}processarConteudo(e,s){let o=e.replace(/\r/g,"").split(`
`).filter(t=>t.trim());if(o.length<2)return[];let r=this.parseTabLine(o[0]),a=o.slice(1).map(t=>this.parseTabLine(t));switch(s){case"remuneracao":return a.map(t=>this.mapRemuneracao(r,t)).filter(t=>t.valorTotalPago>=0).sort((t,i)=>{let c=new Date(t.dtEntrada),n=new Date(i.dtEntrada);return c.getTime()-n.getTime()});case"orcamentos":return a.map(t=>this.mapOrcamento(r,t));case"contas":return a.map(t=>this.mapContas(r,t));default:return[]}}parseTabLine(e){return e.split("	").map(s=>s.replace(/^"(.*)"$/,"$1").replace(/"/g,"").trim())}findHeader(e,s){for(let o of s){let r=e.findIndex(a=>a.toLowerCase().includes(o.toLowerCase())||o.toLowerCase().includes(a.toLowerCase()));if(r!==-1)return e[r]}return null}createMapper(e){return(s,o)=>{let r=i=>{let c=this.findHeader(s,i);if(!c)return"";let n=s.indexOf(c);return o[n]||""},a=i=>{let c=r(i);return parseFloat(c.replace(",","."))||0},t={};for(let[i,c]of Object.entries(e)){let n=c;n.type==="number"?t[i]=a(n.headers):t[i]=r(n.headers)}return t}}mapRemuneracao=this.createMapper(this.remuneracaoMapping);mapOrcamento=this.createMapper(this.orcamentoMapping);mapContas=this.createMapper(this.contasMapping);extrairCabecalhosDoMapping(e){let s;switch(e){case"remuneracao":s=this.remuneracaoMapping;break;case"orcamentos":s=this.orcamentoMapping;break;case"contas":s=this.contasMapping;break;default:return[]}let o=[];for(let[r,a]of Object.entries(s)){let t=a;t.headers&&Array.isArray(t.headers)&&o.push(...t.headers)}return[...new Set(o)]}atualizarDados(e,s){switch(e){case"remuneracao":this.dadosRemuneracao.set(s);break;case"orcamentos":this.dadosOrcamentos.set(s);break;case"contas":this.dadosContas.set(s);break}}a1gruparDados(e,s){let o={},r=[],a=this.dadosRemuneracao(),t=this.dadosOrcamentos(),i=this.dadosContas();if(e==="profissional"){let n=new Set;return a.forEach(l=>{l.profissionalCodigo&&l.profissionalNome&&n.add(`${l.profissionalCodigo} - ${l.profissionalNome}`)}),n.forEach(l=>{o[l]={remuneracao:[],orcamentos:[],contas:[],info:null}}),a.forEach(l=>{let d=this.getChaveAgrupamento(l,e);d&&d!=="SEM IDENTIFICA\xC7\xC3O"&&o[d]&&(o[d].remuneracao.push(l),o[d].info||(o[d].info=l))}),Object.keys(o).forEach(l=>{let d=o[l],u=new Set(d.remuneracao.map(p=>p.pacienteCodigo));t.forEach(p=>{u.has(p.pacienteCodigo)&&d.orcamentos.push(p)}),i.forEach(p=>{u.has(p.pacienteCodigo)&&d.contas.push(p)})}),o}switch(e){case"profissao":r=[...a,...t,...i];break;case"convenio":r=[...a,...t,...i];break;case"paciente":r=[...a,...t,...i];break;case"cooperativa":r=[...a,...t,...i];break;default:r=[...a,...t,...i]}let c=new Set;return r.forEach(n=>{if(n){let l=this.getChaveAgrupamento(n,e);l&&c.add(l)}}),c.forEach(n=>{o[n]={remuneracao:[],orcamentos:[],contas:[],info:null}}),Object.keys(o).forEach(n=>{a.forEach(l=>{this.getChaveAgrupamento(l,e)===n&&(o[n].remuneracao.push(l),o[n].info||(o[n].info=l))}),t.forEach(l=>{this.getChaveAgrupamento(l,e)===n&&(o[n].orcamentos.push(l),o[n].info||(o[n].info=l))}),i.forEach(l=>{this.getChaveAgrupamento(l,e)===n&&(o[n].contas.push(l),o[n].info||(o[n].info=l))})}),o}agruparDados(e,s){let o={},r=this.dadosRemuneracao(),a=this.dadosOrcamentos(),t=this.dadosContas();if(e==="profissional"){let c=new Set;return r.forEach(n=>{n.profissionalCodigo&&n.profissionalNome&&c.add(`${n.profissionalCodigo} - ${n.profissionalNome}`)}),c.forEach(n=>{o[n]={remuneracao:[],orcamentos:[],contas:[],info:null}}),r.forEach(n=>{let l=this.getChaveAgrupamento(n,e);l&&l!=="SEM IDENTIFICA\xC7\xC3O"&&o[l]&&(o[l].remuneracao.push(n),o[l].info||(o[l].info=n))}),Object.keys(o).forEach(n=>{let l=o[n],d=new Set(l.remuneracao.map(u=>u.pacienteCodigo));a.forEach(u=>{d.has(u.pacienteCodigo)&&l.orcamentos.push(u)}),t.forEach(u=>{d.has(u.pacienteCodigo)&&l.contas.push(u)})}),o}let i=new Set;return r.forEach(c=>{if(c){let n=this.getChaveAgrupamento(c,e);n&&n.trim()!==""&&i.add(n)}}),a.forEach(c=>{if(c){let n=this.getChaveAgrupamento(c,e);n&&n.trim()!==""&&i.add(n)}}),t.forEach(c=>{if(c){let n=this.getChaveAgrupamento(c,e);n&&n.trim()!==""&&i.add(n)}}),i.forEach(c=>{o[c]={remuneracao:[],orcamentos:[],contas:[],info:null}}),r.forEach(c=>{let n=this.getChaveAgrupamento(c,e);n&&o[n]&&(o[n].remuneracao.push(c),o[n].info||(o[n].info=c))}),a.forEach(c=>{let n=this.getChaveAgrupamento(c,e);n&&o[n]&&(o[n].orcamentos.push(c),o[n].info||(o[n].info=c))}),t.forEach(c=>{let n=this.getChaveAgrupamento(c,e);n&&o[n]&&(o[n].contas.push(c),o[n].info||(o[n].info=c))}),o}getChaveAgrupamento(e,s){if(!e)return"";switch(s){case"profissional":return e.profissionalCodigo&&e.profissionalNome?`${e.profissionalCodigo} - ${e.profissionalNome}`:"SEM IDENTIFICA\xC7\xC3O";case"profissao":return e.profissaoCodigo&&e.profissaoDescricao?`${e.profissaoCodigo} - ${e.profissaoDescricao}`:"SEM PROFISS\xC3O";case"convenio":return e.convenioCodigo&&e.convenioDescricao?`${e.convenioCodigo} - ${e.convenioDescricao}`:"SEM CONV\xCANIO";case"paciente":return e.pacienteCodigo&&e.pacienteNome?`${e.pacienteCodigo} - ${e.pacienteNome}`:"SEM PACIENTE";case"cooperativa":return e.cooperativaCodigo&&e.cooperativaDescricao?`${e.cooperativaCodigo} - ${e.cooperativaDescricao}`:"SEM COOPERATIVA";default:return e.profissionalNome||e.pacienteNome||"SEM NOME"}}c1alcularEstatisticas(e,s,o){return Object.keys(e).map(r=>{let a=e[r],t=a.remuneracao.reduce((d,u)=>{let p=u.valorTotalPago||0,f=o&&u.ajudaCusto||0;return d+p+f},0),i,c;s==="profissional"||(i=a.orcamentos.reduce((d,u)=>d+(u.valorTotal||0),0),c=a.contas.reduce((d,u)=>d+(u.valorTotal||0),0));let n=c-t,l=c>0?n/c:0;return{chave:r,descricao:this.getDescricaoGrupo(a,s),totalPago:t,totalOrcado:i,totalFaturado:c,margem:l*100,lucroBruto:n,contadores:{remuneracao:a.remuneracao.length,orcamentos:a.orcamentos.length,contas:a.contas.length},referencias:this.extrairReferencias(a),incluiuAjudaCusto:o,tipoCalculo:s==="profissional"?"proporcional":"direto"}}).filter(r=>r.contadores.remuneracao>0)}c2alcularEstatisticas(e,s,o){return Object.keys(e).map(r=>{let a=e[r],t=0;a.remuneracao&&a.remuneracao.length>0&&(t=a.remuneracao.reduce((d,u)=>{let p=u.valorTotalPago||0,f=o&&u.ajudaCusto||0;return d+p+f},0));let i,c;s==="profissional"||(i=a.orcamentos?a.orcamentos.reduce((d,u)=>d+(u.valorTotal||0),0):0,c=a.contas?a.contas.reduce((d,u)=>d+(u.valorTotal||0),0):0);let n=c-t,l=c>0?n/c:0;return{chave:r,descricao:this.getDescricaoGrupo(a,s),totalPago:t,totalOrcado:i,totalFaturado:c,margem:l*100,lucroBruto:n,contadores:{remuneracao:a.remuneracao?a.remuneracao.length:0,orcamentos:a.orcamentos?a.orcamentos.length:0,contas:a.contas?a.contas.length:0},referencias:this.extrairReferencias(a),incluiuAjudaCusto:o,tipoCalculo:s==="profissional"?"proporcional":"direto"}}).filter(r=>r.contadores.remuneracao>0||r.contadores.orcamentos>0||r.contadores.contas>0)}calcularImpostosCooperativa(e,s=!1){if(e.length===0)return{custoTotal:0,detalhesCalculo:{valorProdutividade:0,ajudaCusto:0,valorBase:0,taxas:{txAdm:0,inss:0,iss:0,irrf:0,pis:0,cofins:0},percentuais:{txAdm:0,inss:0,iss:0,irrf:0,pis:0,cofins:0},incluirAjudaCusto:!1}};let o=e[0],r={txAdm:o.coopTxAdm||0,inss:o.coopInss||0,iss:o.coopIss||0,irrf:o.coopIrrf||0,pis:o.coopPis||0,cofins:o.coopCofins||0},a=e.reduce((m,g)=>m+(g.valorTotalPago||0),0),t=s?e.reduce((m,g)=>m+(g.ajudaCusto||0),0):0,i=a+t,c=i*r.txAdm/100,n=i*r.inss/100,l=i*r.iss/100,d=a*r.irrf/100,u=(a+c)*r.pis/100,p=c*r.cofins/100;return{custoTotal:i+c-(n+l+d+u+p),detalhesCalculo:{valorProdutividade:a,ajudaCusto:t,valorBase:i,taxas:{txAdm:c,inss:n,iss:l,irrf:d,pis:u,cofins:p},percentuais:r,incluirAjudaCusto:s}}}calcularEstatisticas(e,s,o){return Object.keys(e).map(r=>{let a=e[r],t=0,i=null;if(s==="cooperativa"&&a.remuneracao&&a.remuneracao.length>0){let p=this.calcularImpostosCooperativa(a.remuneracao,o);t=p.custoTotal,i=p.detalhesCalculo}else a.remuneracao&&a.remuneracao.length>0&&(t=a.remuneracao.reduce((p,f)=>{let m=f.valorTotalPago||0,g=o&&f.ajudaCusto||0;return p+m+g},0));let c,n;if(s==="profissional"){let p=this.calcularValoresProporcionaisProfissional(a.remuneracao,a.orcamentos,a.contas);c=p.totalOrcadoProporcional,n=p.totalFaturadoProporcional}else c=a.orcamentos?a.orcamentos.reduce((p,f)=>p+(f.valorTotal||0),0):0,n=a.contas?a.contas.reduce((p,f)=>p+(f.valorTotal||0),0):0;let l=n-t,d=n>0?l/n:0,u={chave:r,descricao:this.getDescricaoGrupo(a,s),totalPago:t,totalOrcado:c,totalFaturado:n,margem:d*100,lucroBruto:l,contadores:{remuneracao:a.remuneracao?a.remuneracao.length:0,orcamentos:a.orcamentos?a.orcamentos.length:0,contas:a.contas?a.contas.length:0},detalhes:a,referencias:this.extrairReferencias(a),incluiuAjudaCusto:o,tipoCalculo:s==="profissional"?"proporcional":s==="cooperativa"?"cooperativa":"direto"};return s==="cooperativa"&&i&&(u.detalhesCalculoCooperativa=i),u}).filter(r=>r.contadores.remuneracao>0||r.contadores.orcamentos>0||r.contadores.contas>0)}c1alcularValoresProporcionaisProfissional(e,s,o){return{totalOrcadoProporcional:0,totalFaturadoProporcional:0,detalhesCalculo:[]}}calcularValoresProporcionaisProfissional(e,s,o){let r={totalOrcadoProporcional:0,totalFaturadoProporcional:0,detalhesCalculo:[],totalOrcadoDireto:0,totalFaturadoDireto:0},a={};return e.forEach(t=>{a[t.pacienteCodigo]||(a[t.pacienteCodigo]=[]),a[t.pacienteCodigo].push(t)}),Object.keys(a).forEach(t=>{let i=a[t],c=i.reduce((h,C)=>h+C.valorTotalPago,0),l=this.dadosRemuneracao().filter(h=>h.pacienteCodigo===t).reduce((h,C)=>h+C.valorTotalPago,0),d=l>0?c/l:0,u=s.filter(h=>h.pacienteCodigo===t),p=o.filter(h=>h.pacienteCodigo===t),f=u.reduce((h,C)=>h+C.valorTotal,0),m=p.reduce((h,C)=>h+C.valorTotal,0),g=f*d,b=m*d;r.totalOrcadoProporcional+=g,r.totalFaturadoProporcional+=b,r.totalOrcadoDireto+=f,r.totalFaturadoDireto+=m,(f>0||m>0||c>0)&&r.detalhesCalculo.push({pacienteCodigo:t,pacienteNome:i[0]?.pacienteNome,totalPagoProfissional:c,totalPagoTodosProfissionais:l,proporcao:(d*100).toFixed(2)+"%",proporcaoDecimal:d,totalOrcadoPaciente:f,totalFaturadoPaciente:m,orcadoProporcional:g,faturadoProporcional:b,qtdOrcamentos:u.length,qtdContas:p.length,qtdRemuneracoes:i.length})}),r}getDescricaoGrupo(e,s){let o=e.info;if(!o)return"";let r=e.remuneracao?.length||0;switch(s){case"profissional":return o.profissaoDescricao+` ( ${r} atendimento${r>1?"s":""} )`;case"profissao":return`${r} atendimento${r>1?"s":""}`;case"convenio":return`${r} atendimento${r>1?"s":""}`;case"paciente":return o.convenioDescricao+`${r} atendimento${r>1?"s":""}`;case"cooperativa":return`${r} atendimento${r>1?"s":""}`;default:return""}}g1etDescricaoGrupo(e,s){let o=e.info;if(!o)return"";switch(s){case"profissional":return o.profissaoDescricao||"";case"profissao":let r=e.remuneracao?.length||0,a=e.orcamentos?.length||0,t=e.contas?.length||0;return r>0?`${r} atendimentos`:a>0&&t>0?`${a} or\xE7amentos, ${t} contas`:a>0?`${a} or\xE7amentos`:t>0?`${t} contas`:"Sem movimenta\xE7\xE3o";case"convenio":return`${(e.remuneracao?.length||0)+(e.orcamentos?.length||0)+(e.contas?.length||0)} registros`;case"paciente":return o.convenioDescricao||"";case"cooperativa":return`${e.remuneracao?new Set(e.remuneracao.map(n=>n.profissionalCodigo)).size:0} profissionais ativos`;default:return""}}e1xtrairReferencias(e){return{pacientes:[...new Set([...e.remuneracao.map(s=>`${s.pacienteCodigo} - ${s.pacienteNome}`),...e.orcamentos.map(s=>`${s.pacienteCodigo} - ${s.pacienteNome}`),...e.contas.map(s=>`${s.pacienteCodigo} - ${s.pacienteNome}`)].filter(s=>s!==" - "&&s.trim()!==""))],convenios:[],profissionais:[],cooperativas:[],profissoes:[],orcamentos:[],contas:[]}}extrairReferencias(e){let s=(o,...r)=>!o||o.length===0?[]:[...new Set(o.map(a=>{let i=r.map(c=>a[c]||"").join(" - ");return i!==" - "&&i.trim()!==""?i:null}).filter(a=>a!==null))];return{pacientes:this.ordenarMatriz([...new Set([...s(e.remuneracao||[],"pacienteCodigo","pacienteNome"),...s(e.orcamentos||[],"pacienteCodigo","pacienteNome"),...s(e.contas||[],"pacienteCodigo","pacienteNome")].filter(o=>o!==" - "&&o.trim()!==""))]),convenios:this.ordenarMatriz([...new Set([...s(e.remuneracao||[],"convenioCodigo","convenioDescricao"),...s(e.orcamentos||[],"convenioCodigo","convenioDescricao"),...s(e.contas||[],"convenioCodigo","convenioDescricao")].filter(o=>o!==" - "&&o.trim()!==""))]),profissionais:this.ordenarMatriz([...new Set([...s(e.remuneracao||[],"profissionalCodigo","profissionalNome"),...s(e.orcamentos||[],"profissionalCodigo","profissionalNome"),...s(e.contas||[],"profissionalCodigo","profissionalNome")].filter(o=>o!==" - "&&o.trim()!==""))]),cooperativas:this.ordenarMatriz([...new Set([...s(e.remuneracao||[],"cooperativaCodigo","cooperativaDescricao"),...s(e.orcamentos||[],"cooperativaCodigo","cooperativaDescricao"),...s(e.contas||[],"cooperativaCodigo","cooperativaDescricao")].filter(o=>o!==" - "&&o.trim()!==""))]),profissoes:this.ordenarMatriz([...new Set([...s(e.remuneracao||[],"profissaoCodigo","profissaoDescricao"),...s(e.orcamentos||[],"profissaoCodigo","profissaoDescricao"),...s(e.contas||[],"profissaoCodigo","profissaoDescricao")].filter(o=>o!==" - "&&o.trim()!==""))]),orcamentos:this.ordenarMatriz([...new Set((e.orcamentos||[]).map(o=>o.orcamento).filter(o=>o&&o.trim()!==""))]),contas:this.ordenarMatriz([...new Set((e.contas||[]).map(o=>o.conta).filter(o=>o&&o.trim()!==""))])}}ordenarMatriz(e){return e.sort((s,o)=>{let r=s.split("-")[1]?.trim().toUpperCase()||"",a=o.split("-")[1]?.trim().toUpperCase()||"",t=r.startsWith("SEM"),i=a.startsWith("SEM");return t&&!i?1:!t&&i?-1:r.localeCompare(a,"pt-BR",{sensitivity:"base"})})}ordenarDados(e,s){e.sort((o,r)=>{switch(s){case"totalPago":return r.totalPago-o.totalPago||r.lucroBruto-o.lucroBruto;case"totalPrevisto":return r.totalOrcado-o.totalOrcado||r.lucroBruto-o.lucroBruto;case"totalFaturado":return r.totalFaturado-o.totalFaturado||r.lucroBruto-o.lucroBruto;case"lucroBruto":return r.lucroBruto-o.lucroBruto||r.margem-o.margem;case"margem":return r.margem-o.margem||r.lucroBruto-o.lucroBruto;case"nome":return this.compararPorNome(o,r);default:return r.totalPago-o.totalPago}})}compararPorNome(e,s){let o=c=>c?c.includes(" - ")?c.split(" - ")[1].trim():c.trim():"",r=o(e.chave),a=o(s.chave),t=r.toUpperCase().startsWith("SEM "),i=a.toUpperCase().startsWith("SEM ");return t&&!i?1:!t&&i?-1:r.localeCompare(a,"pt-BR",{numeric:!0,sensitivity:"base"})}c1alcularResumoGeral(e,s,o){let r={totalPago:e.reduce((a,t)=>a+t.totalPago,0),totalOrcado:e.reduce((a,t)=>a+t.totalOrcado,0),totalFaturado:e.reduce((a,t)=>a+t.totalFaturado,0),incluiuAjudaCusto:o,tipoCalculo:s==="profissional"?"proporcional":s==="cooperativa"?"cooperativa":"direto",lucroBruto:0,margem:0};return r.lucroBruto=r.totalFaturado-r.totalPago,r.margem=r.totalFaturado>0?r.lucroBruto/r.totalFaturado:0,s==="cooperativa"&&(r.totalCooperativa={totalTxAdm:e.reduce((a,t)=>{if(t.detalhesCalculoCooperativa?.taxas){let c=t.detalhesCalculoCooperativa.taxas.txAdm||0;return a+c}return a},0),totalImpostos:e.reduce((a,t)=>{if(t.detalhesCalculoCooperativa?.taxas){let i=t.detalhesCalculoCooperativa.taxas,c=(i.inss||0)-(i.iss||0)-(i.irrf||0)-(i.pis||0)-(i.cofins||0);return a+c}return a},0)}),r}calcularResumoGeral(e,s,o){let r={totalPago:e.reduce((a,t)=>a+t.totalPago,0),totalOrcado:e.reduce((a,t)=>a+t.totalOrcado,0),totalFaturado:e.reduce((a,t)=>a+t.totalFaturado,0),incluiuAjudaCusto:o,tipoCalculo:s==="profissional"?"proporcional":s==="cooperativa"?"cooperativa":"direto",lucroBruto:0,margem:0};return r.lucroBruto=r.totalFaturado-r.totalPago,r.margem=r.totalFaturado>0?r.lucroBruto/r.totalFaturado:0,s==="cooperativa"&&(r.totalCooperativa={totalTxAdm:e.reduce((a,t)=>{let i=t;if(i.detalhesCalculoCooperativa?.taxas){let c=i.detalhesCalculoCooperativa.taxas;return a+(c.txAdm||0)}return a},0),totalImpostos:e.reduce((a,t)=>{let i=t;if(i.detalhesCalculoCooperativa?.taxas){let c=i.detalhesCalculoCooperativa.taxas,n=(c.inss||0)-(c.iss||0)-(c.irrf||0)-(c.pis||0)-(c.cofins||0);return a+n}return a},0)}),r}static \u0275fac=function(s){return new(s||P)(O(T))};static \u0275prov=A({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();export{S as a};
