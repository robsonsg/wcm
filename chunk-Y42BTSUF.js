import{a as L}from"./chunk-5267M4YT.js";import{c as U,d as y,f as O,g as B,j as $,m as j,n as W,s as G,t as V,u as H}from"./chunk-EUYLE5IP.js";import{k as R,l as N,w as k}from"./chunk-RLCM72IK.js";import{Db as _,Ib as h,Jb as S,Ra as a,Vb as r,Wb as p,Xb as d,Z as I,aa as M,ab as F,g as u,ga as x,gb as f,n as T,oa as w,ob as m,pa as C,qb as A,sb as D,v as E,xb as s,yb as i,zb as g}from"./chunk-27GLVKKX.js";var P=(()=>{class c{http=x(L);apiUrl="https://api.homecare.com/trusted-devices";currentDeviceSubject=new T(null);currentDevice$=this.currentDeviceSubject.asObservable();generateDeviceFingerprint(){return new Promise(e=>{let n={userAgent:navigator.userAgent,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,platform:navigator.platform,cookiesEnabled:navigator.cookieEnabled,localStorageEnabled:this.isStorageAvailable("localStorage"),sessionStorageEnabled:this.isStorageAvailable("sessionStorage"),indexedDBEnabled:"indexedDB"in window,hardwareConcurrency:navigator.hardwareConcurrency||0,deviceMemory:navigator.deviceMemory};this.getCanvasFingerprint().then(t=>{n.canvas=t,this.getWebGLFingerprint().then(o=>{n.webgl=o;let l=JSON.stringify(n);this.generateHash(l).then(v=>{e(v)})})})})}generateHash(e){return u(this,null,function*(){let t=new TextEncoder().encode(e),o=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map(v=>v.toString(16).padStart(2,"0")).join("")})}getCanvasFingerprint(){return new Promise(e=>{let n=document.createElement("canvas"),t=n.getContext("2d");t.textBaseline="top",t.font="14px Arial",t.fillText("HomeCare Device Check \u{1F3E5}",2,2),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillRect(100,5,80,20),e(n.toDataURL())})}getWebGLFingerprint(){return new Promise(e=>{let n=document.createElement("canvas"),t=n.getContext("webgl")||n.getContext("experimental-webgl");if(!t){e("webgl-not-supported");return}let o=t,l=o.getExtension("WEBGL_debug_renderer_info"),v=o.getParameter(l?.UNMASKED_VENDOR_WEBGL??o.VENDOR),z=o.getParameter(l?.UNMASKED_RENDERER_WEBGL??o.RENDERER);e(`${v}~${z}`)})}isStorageAvailable(e){try{let n=window[e],t="__storage_test__";return n.setItem(t,"test"),n.removeItem(t),!0}catch{return!1}}checkCurrentDevice(e){return u(this,null,function*(){let n=yield this.generateDeviceFingerprint();try{let o=(yield E(this.http.get(`${this.apiUrl}/user/${e}`))).find(l=>l.deviceFingerprint===n&&l.isActive);return o?(this.currentDeviceSubject.next(o),this.updateLastAccess(o.id).subscribe(),!0):!1}catch(t){return console.error("Erro ao verificar dispositivo:",t),!1}})}registerTrustedDevice(e,n){return u(this,null,function*(){let t=yield this.generateDeviceFingerprint(),o={userId:e,deviceFingerprint:t,deviceName:n,operatingSystem:this.getOS(),browser:this.getBrowser(),ipAddress:yield this.getClientIP(),trustLevel:"MEDIUM",isActive:!0,createdAt:new Date,lastAccess:new Date};console.log("Registering new trusted device:",o);try{return yield E(this.http.post(`${this.apiUrl}`,o).pipe(I(v=>this.currentDeviceSubject.next(v))))}catch(l){throw console.error("Erro ao registrar dispositivo confi\xE1vel:",l),l}})}getUserTrustedDevices(e){return this.http.get(`${this.apiUrl}/user/${e}`)}removeTrustedDevice(e){return this.http.delete(`${this.apiUrl}/${e}`)}updateLastAccess(e){return this.http.patch(`${this.apiUrl}/${e}/access`,{lastAccess:new Date})}canUseRememberMe(){let e=this.currentDeviceSubject.value;return!e||!e.isActive?!1:["HIGH","MEDIUM"].includes(e.trustLevel)}getOS(){let e=navigator.userAgent;return e.includes("Windows NT 10.0")?"Windows 11":e.includes("Windows NT")?"Windows":e.includes("Mac OS X")?"macOS":e.includes("Linux")?"Linux":"Unknown"}getBrowser(){let e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Unknown"}getClientIP(){return u(this,null,function*(){try{return(yield(yield fetch("https://api.ipify.org?format=json")).json()).ip}catch{return"Unknown"}})}static \u0275fac=function(n){return new(n||c)};static \u0275prov=M({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();function q(c,b){if(c&1){let e=_();s(0,"div",39)(1,"button",40),h("click",function(){w(e);let t=S();return C(t.showRegisterModal=!0)}),s(2,"span",41),r(3,"\u2795"),i(),r(4," Registrar Este Dispositivo "),i()()}}function X(c,b){if(c&1){let e=_();s(0,"tr")(1,"td")(2,"div",42)(3,"span",30),r(4),i(),s(5,"div")(6,"div",31),r(7),i(),s(8,"div",43),r(9),i()()()(),s(10,"td"),r(11),i(),s(12,"td"),r(13),i(),s(14,"td")(15,"div",44),r(16),i()(),s(17,"td"),r(18),i(),s(19,"td")(20,"div",44),r(21),i()(),s(22,"td")(23,"div",45)(24,"button",46),h("click",function(){let t=w(e).$implicit,o=S();return C(o.removeDevice(t.id))}),r(25," \u{1F5D1}\uFE0F "),i()()()()}if(c&2){let e=b.$implicit,n=S();D(e.id===(n.currentDevice==null?null:n.currentDevice.id)?"bg-primary/10":""),a(4),p(n.getDeviceIcon(e)),a(3),p(e.deviceName),a(2),d(" ",e.id===(n.currentDevice==null?null:n.currentDevice.id)?"(Dispositivo Atual)":""," "),a(2),p(e.operatingSystem),a(2),p(e.browser),a(2),D(n.getTrustLevelClass(e.trustLevel)),a(),d(" ",n.getTrustLevelText(e.trustLevel)," "),a(2),p(n.formatDate(e.lastAccess)),a(2),D(e.isActive?"badge-success":"badge-error"),a(),d(" ",e.isActive?"Ativo":"Inativo"," "),a(3),m("disabled",e.id===(n.currentDevice==null?null:n.currentDevice.id))}}function J(c,b){c&1&&(s(0,"div",47)(1,"span",48),r(2,"\u{1F50D}"),i(),r(3," Nenhum dispositivo confi\xE1vel registrado "),i())}function Z(c,b){c&1&&(s(0,"label",25)(1,"span",49),r(2,"Nome \xE9 obrigat\xF3rio"),i()())}function Q(c,b){c&1&&g(0,"span",50)}var ve=(()=>{class c{trustedDeviceService=x(P);fb=x(G);trustedDevices=[];currentDevice=null;showRegisterModal=!1;isRegistering=!1;fingerprint=null;registerForm;currentDeviceStatus="Verificando...";currentDeviceMessage="";isCurrentDeviceTrusted=!1;canRemember=!1;detectedOS="";detectedBrowser="";constructor(){this.registerForm=this.fb.group({deviceName:["",[y.required,y.minLength(3)]]})}ngOnInit(){return u(this,null,function*(){this.detectSystemInfo(),this.checkCurrentDevice(),this.loadTrustedDevices(),this.fingerprint=yield this.trustedDeviceService.generateDeviceFingerprint(),this.trustedDeviceService.currentDevice$.subscribe(e=>{this.currentDevice=e,this.updateDeviceStatus()})})}detectSystemInfo(){this.detectedOS=this.getOS(),this.detectedBrowser=this.getBrowser()}checkCurrentDevice(){return u(this,null,function*(){let e="user123";this.isCurrentDeviceTrusted=yield this.trustedDeviceService.checkCurrentDevice(e),this.canRemember=this.trustedDeviceService.canUseRememberMe(),this.updateDeviceStatus()})}updateDeviceStatus(){this.isCurrentDeviceTrusted&&this.currentDevice?(this.currentDeviceStatus="\u2705 Confi\xE1vel",this.currentDeviceMessage=`Dispositivo "${this.currentDevice.deviceName}" est\xE1 registrado e ativo`):(this.currentDeviceStatus="\u26A0\uFE0F N\xE3o Confi\xE1vel",this.currentDeviceMessage="Este dispositivo n\xE3o est\xE1 registrado como confi\xE1vel")}loadTrustedDevices(){this.trustedDeviceService.getUserTrustedDevices("user123").subscribe(n=>{this.trustedDevices=n})}registerDevice(){return u(this,null,function*(){if(this.registerForm.invalid)return;this.isRegistering=!0;let e="user123",n=this.registerForm.get("deviceName")?.value;try{yield this.trustedDeviceService.registerTrustedDevice(e,n),this.showRegisterModal=!1,this.registerForm.reset(),this.loadTrustedDevices(),this.checkCurrentDevice()}catch(t){console.error("Erro ao registrar dispositivo:",t)}finally{this.isRegistering=!1}})}removeDevice(e){confirm("Tem certeza que deseja remover este dispositivo confi\xE1vel?")&&this.trustedDeviceService.removeTrustedDevice(e).subscribe(()=>{this.loadTrustedDevices(),this.currentDevice?.id===e&&this.checkCurrentDevice()})}getStatusClass(){return this.isCurrentDeviceTrusted?"text-success":"text-warning"}getDeviceIcon(e){return e.operatingSystem.includes("Windows")?"\u{1F5A5}\uFE0F":e.operatingSystem.includes("Mac")?"\u{1F4BB}":e.operatingSystem.includes("Linux")?"\u{1F427}":"\u{1F4F1}"}getTrustLevelClass(e){switch(e){case"HIGH":return"badge-success";case"MEDIUM":return"badge-warning";case"LOW":return"badge-error";default:return"badge-ghost"}}getTrustLevelText(e){switch(e){case"HIGH":return"Alto";case"MEDIUM":return"M\xE9dio";case"LOW":return"Baixo";default:return"Indefinido"}}formatDate(e){return new Date(e).toLocaleString("pt-BR")}getOS(){let e=navigator.userAgent;return e.includes("Windows NT 10.0")?"Windows 11":e.includes("Windows NT")?"Windows":e.includes("Mac OS X")?"macOS":e.includes("Linux")?"Linux":"Desconhecido"}getBrowser(){let e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Desconhecido"}static \u0275fac=function(n){return new(n||c)};static \u0275cmp=F({type:c,selectors:[["app-trusted-device-manager"]],decls:90,vars:21,consts:[[1,"container","mx-auto","p-6","max-w-6xl"],[1,"mb-8"],[1,"text-3xl","font-bold","text-primary","mb-2"],[1,"text-base-content/70"],[1,"card","bg-base-100","shadow-xl","mb-6"],[1,"card-body"],[1,"card-title","flex","items-center","gap-2"],[1,"text-2xl"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mt-4"],[1,"stat","bg-base-200","rounded-lg"],[1,"stat-title"],[1,"stat-value","text-lg"],[1,"stat-desc"],["class","card-actions justify-end mt-4",4,"ngIf"],[1,"card","bg-base-100","shadow-xl"],[1,"card-title","flex","items-center","gap-2","mb-4"],[1,"overflow-x-auto"],[1,"table","table-zebra"],[3,"class",4,"ngFor","ngForOf"],["class","text-center py-8 text-base-content/50",4,"ngIf"],[1,"modal"],[1,"modal-box"],[1,"font-bold","text-lg","mb-4"],[3,"ngSubmit","formGroup"],[1,"form-control","mb-4"],[1,"label"],[1,"label-text"],["type","text","formControlName","deviceName","placeholder","Ex: PC-Casa, Laptop-Trabalho",1,"input","input-bordered"],["class","label",4,"ngIf"],[1,"alert","alert-info","mb-4"],[1,"text-xl"],[1,"font-semibold"],[1,"text-sm","mt-1"],[1,"break-all","text-xs","font-mono","text-gray-700","dark:text-gray-300"],[1,"modal-action"],["type","button",1,"btn","btn-ghost",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","loading loading-spinner loading-sm",4,"ngIf"],[1,"modal-backdrop",3,"click"],[1,"card-actions","justify-end","mt-4"],[1,"btn","btn-primary",3,"click"],[1,"text-lg","mr-2"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-base-content/70"],[1,"badge"],[1,"flex","gap-2"],[1,"btn","btn-sm","btn-error",3,"click","disabled"],[1,"text-center","py-8","text-base-content/50"],[1,"text-4xl","block","mb-2"],[1,"label-text-alt","text-error"],[1,"loading","loading-spinner","loading-sm"]],template:function(n,t){if(n&1&&(s(0,"div",0)(1,"div",1)(2,"h1",2),r(3," \u{1F512} Gerenciamento de Dispositivos Confi\xE1veis "),i(),s(4,"p",3),r(5," Sistema HomeCare - Controle de seguran\xE7a e acesso "),i()(),s(6,"div",4)(7,"div",5)(8,"h2",6)(9,"span",7),r(10,"\u{1F5A5}\uFE0F"),i(),r(11," Status do Dispositivo Atual "),i(),s(12,"div",8)(13,"div",9)(14,"div",10),r(15,"Status de Confian\xE7a"),i(),s(16,"div",11),r(17),i(),s(18,"div",12),r(19),i()(),s(20,"div",9)(21,"div",10),r(22,"Lembrar-me Dispon\xEDvel"),i(),s(23,"div",11),r(24),i(),s(25,"div",12),r(26),i()()(),f(27,q,5,0,"div",13),i()(),s(28,"div",14)(29,"div",5)(30,"h2",15)(31,"span",7),r(32,"\u{1F4F1}"),i(),r(33," Meus Dispositivos Confi\xE1veis "),i(),s(34,"div",16)(35,"table",17)(36,"thead")(37,"tr")(38,"th"),r(39,"Dispositivo"),i(),s(40,"th"),r(41,"Sistema"),i(),s(42,"th"),r(43,"Navegador"),i(),s(44,"th"),r(45,"N\xEDvel de Confian\xE7a"),i(),s(46,"th"),r(47,"\xDAltimo Acesso"),i(),s(48,"th"),r(49,"Status"),i(),s(50,"th"),r(51,"A\xE7\xF5es"),i()()(),s(52,"tbody"),f(53,X,26,15,"tr",18),i()(),f(54,J,4,0,"div",19),i()()(),s(55,"div",20)(56,"div",21)(57,"h3",22),r(58,"Registrar Dispositivo Confi\xE1vel"),i(),s(59,"form",23),h("ngSubmit",function(){return t.registerDevice()}),s(60,"div",24)(61,"label",25)(62,"span",26),r(63,"Nome do Dispositivo"),i()(),g(64,"input",27),f(65,Z,3,0,"label",28),i(),s(66,"div",29)(67,"span",30),r(68,"\u2139\uFE0F"),i(),s(69,"div")(70,"h4",31),r(71,"Informa\xE7\xF5es do Sistema Detectadas:"),i(),s(72,"p",32),r(73),g(74,"br"),r(75),g(76,"br"),r(77," \u2022 Device UUID:"),g(78,"br"),s(79,"span",33),r(80),i(),g(81,"br"),r(82," \u2022 Este dispositivo ser\xE1 associado ao seu usu\xE1rio de forma segura "),i()()(),s(83,"div",34)(84,"button",35),h("click",function(){return t.showRegisterModal=!1}),r(85," Cancelar "),i(),s(86,"button",36),f(87,Q,1,0,"span",37),r(88),i()()()(),s(89,"div",38),h("click",function(){return t.showRegisterModal=!1}),i()()()),n&2){let o;a(16),D(t.getStatusClass()),a(),d(" ",t.currentDeviceStatus," "),a(2),p(t.currentDeviceMessage),a(4),D(t.canRemember?"text-success":"text-error"),a(),d(" ",t.canRemember?"Sim":"N\xE3o"," "),a(2),d(" ",t.canRemember?"Dispositivo seguro para auto-login":"Registre este dispositivo primeiro"," "),a(),m("ngIf",!t.isCurrentDeviceTrusted),a(26),m("ngForOf",t.trustedDevices),a(),m("ngIf",t.trustedDevices.length===0),a(),A("modal-open",t.showRegisterModal),a(4),m("formGroup",t.registerForm),a(6),m("ngIf",((o=t.registerForm.get("deviceName"))==null?null:o.invalid)&&((o=t.registerForm.get("deviceName"))==null?null:o.touched)),a(8),d(" \u2022 Sistema: ",t.detectedOS,""),a(2),d(" \u2022 Navegador: ",t.detectedBrowser,""),a(5),d(" ",t.fingerprint||"Carregando..."," "),a(6),m("disabled",t.registerForm.invalid||t.isRegistering),a(),m("ngIf",t.isRegistering),a(),d(" ",t.isRegistering?"Registrando...":"Registrar Dispositivo"," ")}},dependencies:[k,R,N,V,$,U,O,B,H,j,W],encapsulation:2})}return c})();export{ve as TrustedDeviceManagerComponent};
