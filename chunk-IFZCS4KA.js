import{d as n,s as m}from"./chunk-OVH4RFKH.js";import{aa as l,ga as d,n as u}from"./chunk-5HUFPCHR.js";var v=(()=>{class c{fb=d(m);formConfigSubject=new u(null);formConfig$=this.formConfigSubject.asObservable();formDataSubject=new u(null);formData$=this.formDataSubject.asObservable();buildFormGroup(r,e){let t={};return r.campos.filter(o=>o.elementType==="field"&&o.apareceForm).forEach(o=>{let i=this.buildValidators(o),s=this.getInitialValue(o,e);t[o.id]=[s,i]}),this.fb.group(t)}buildValidators(r){let e=[];return r.requerido==="sim"&&e.push(n.required),r.validacoes?.forEach(t=>{switch(t.tipo){case"required":e.push(n.required);break;case"email":e.push(n.email);break;case"minLength":e.push(n.minLength(t.valor));break;case"maxLength":e.push(n.maxLength(t.valor));break;case"pattern":e.push(n.pattern(t.valor));break;case"min":e.push(n.min(t.valor));break;case"max":e.push(n.max(t.valor));break}}),e}getInitialValue(r,e){if(e&&e[r.id]!==void 0)return e[r.id];if(r.conteudoInicial!==void 0)return r.conteudoInicial;switch(r.fieldType){case"checkbox":return!1;case"number":return 0;case"select":return r.opcoes?.find(t=>t.selecionado)?.valor||"";default:return""}}validateForm(r,e){let t={isValid:!0,errors:[]};return r.markAllAsTouched(),e.campos.forEach(a=>{if(a.requerido==="condicional"&&a.condicaoRequerido){let o=this.evaluateCondition(r.value,a.condicaoRequerido.campo,a.condicaoRequerido.valor,a.condicaoRequerido.operador),i=r.get(a.id);o&&i&&!i.value&&(t.isValid=!1,t.errors.push({field:a.id,message:`${a.label} \xE9 obrigat\xF3rio`}))}}),Object.keys(r.controls).forEach(a=>{let o=r.get(a);if(o&&o.errors){let i=e.campos.find(s=>s.id===a);t.isValid=!1,Object.keys(o.errors).forEach(s=>{let h=i?.validacoes?.find(b=>b.tipo===s)?.mensagem||this.getDefaultErrorMessage(s,i?.label||a);t.errors.push({field:a,message:h})})}}),t}evaluateCondition(r,e,t,a){let o=r[e];switch(a){case"=":return o===t;case"!=":return o!==t;case">":return o>t;case"<":return o<t;case">=":return o>=t;case"<=":return o<=t;case"contains":return o&&o.toString().includes(t);default:return!1}}getDefaultErrorMessage(r,e){return{required:`${e} \xE9 obrigat\xF3rio`,email:`${e} deve ter um formato de email v\xE1lido`,minlength:`${e} deve ter pelo menos {requiredLength} caracteres`,maxlength:`${e} n\xE3o pode ter mais de {requiredLength} caracteres`,min:`${e} deve ser maior que {min}`,max:`${e} deve ser menor que {max}`,pattern:`${e} n\xE3o atende ao formato esperado`}[r]||`${e} \xE9 inv\xE1lido`}generateTableColumns(r){return r.campos.filter(e=>e.apareceTable).sort((e,t)=>(e.sequenciaTable||0)-(t.sequenciaTable||0)).map(e=>({key:e.id,label:e.labelTable||e.label,type:e.fieldType||"text",sortable:!0,filterable:!0,width:this.calculateColumnWidth(e),align:e.alinhamento}))}calculateColumnWidth(r){return`${(r.qtdColunaTable||r.qtdColuna)/12*100}%`}applyMask(r,e){if(!e||!r)return r;let t="",a=0;for(let o=0;o<e.length&&a<r.length;o++)if(e[o]==="9")if(/\d/.test(r[a]))t+=r[a],a++;else break;else t+=e[o];return t}isFieldEnabled(r,e,t){switch(r.habilitado){case"nunca":return!1;case"sempre":return!0;case"consulta":return e==="view";case"incluir":return e==="add";case"alterar":return e==="edit";case"incluir_alterar":return e==="add"||e==="edit";case"condicional":return r.condicaoHabilitado&&t?this.evaluateCondition(t,r.condicaoHabilitado.campo,r.condicaoHabilitado.valor,r.condicaoHabilitado.operador):!1;default:return!0}}organizeFieldsByContainer(r){let e={root:[]};return r.campos.filter(t=>t.apareceForm).sort((t,a)=>(t.sequenciaForm||0)-(a.sequenciaForm||0)).forEach(t=>{let a=t.containerParent||"root";e[a]||(e[a]=[]),e[a].push(t)}),e}getContainerFields(r){let e=r.campos.filter(t=>t.elementType==="container").sort((t,a)=>(t.sequenciaForm||0)-(a.sequenciaForm||0));return console.log("Container:",e),e}updateFormConfig(r){this.formConfigSubject.next(r)}updateFormData(r){this.formDataSubject.next(r)}clearFormData(){this.formDataSubject.next(null)}static \u0275fac=function(e){return new(e||c)};static \u0275prov=l({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();export{v as a};
