import{a as q}from"./chunk-OJG6SKOA.js";import{$ as O,Aa as f,Cb as s,Db as l,Eb as _,Gc as W,Ib as M,Ic as F,Jb as w,Kb as g,Lb as V,Mb as z,Pb as S,Qb as k,Rb as R,Sc as H,Tb as a,Ub as u,Vb as A,Za as c,a as C,b as I,db as T,fa as E,g as m,gb as P,lb as y,ma as x,na as v,oa as L,oc as Q,sa as $,tb as h,tc as p,ub as D,va as b,vb as j,wb as B,xb as N}from"./chunk-R5P75FUM.js";var G=["modalBackdrop"],U=["modalContainer"],J=["dynamicComponentContainer"],X=["*"];function Y(o,n){if(o&1&&(s(0,"h3",17),a(1),l()),o&2){let e=g(3);c(),A(" ",e.config.header," ")}}function Z(o,n){if(o&1){let e=M();s(0,"button",18),w("click",function(){x(e);let i=g(3);return v(i.close())}),L(),s(1,"svg",19),_(2,"path",20),l()()}}function ee(o,n){if(o&1&&(s(0,"div",14),y(1,Y,2,1,"h3",15)(2,Z,3,0,"button",16),l()),o&2){let e=g(2);c(),h("ngIf",e.config.header),c(),h("ngIf",e.config.showCloseButton!==!1)}}function te(o,n){o&1&&(s(0,"div",21),_(1,"div",22),s(2,"span",23),a(3,"Capturando tela..."),l()())}function oe(o,n){o&1&&(s(0,"div",21),_(1,"div",24),s(2,"span",23),a(3,"Carregando componente..."),l()())}function ne(o,n){if(o&1){let e=M();s(0,"div",25)(1,"p")(2,"strong"),a(3,"Erro ao carregar componente:"),l()(),s(4,"p"),a(5),l(),s(6,"div",26)(7,"button",27),w("click",function(){x(e);let i=g(2);return v(i.retryLoadComponent())}),a(8," Tentar novamente "),l()()()}if(o&2){let e=g(2);c(5),u(e.errorMessage())}}function ie(o,n){if(o&1&&(s(0,"div",28)(1,"p")(2,"strong"),a(3,"\u{1F50D} Debug Info:"),l()(),s(4,"div",29)(5,"p"),a(6,"Modal Open: "),s(7,"span",30),a(8),l()(),s(9,"p"),a(10,"Should Show: "),s(11,"span",30),a(12),l()(),s(13,"p"),a(14,"Is Capturing: "),s(15,"span",30),a(16),l()(),s(17,"p"),a(18,"Modal ID: "),s(19,"span",30),a(20),l()(),s(21,"p"),a(22,"Component Name: "),s(23,"span",30),a(24),l()(),s(25,"p"),a(26,"Has Injected Component: "),s(27,"span",30),a(28),l()()()()),o&2){let e=g(2);c(8),u(e.isOpen()),c(4),u(e.shouldShowModal()),c(4),u(e.screenCaptureService.isCapturing()),c(4),u(e.config.modalId||"N/A"),c(4),u(e.config.componentName||"N/A"),c(4),u(!!e.injectedComponentRef)}}function se(o,n){o&1&&(s(0,"div",31)(1,"p"),a(2,"Nenhum conte\xFAdo para exibir"),l(),s(3,"p",32),a(4,"Verifique se o componente foi configurado corretamente"),l()())}function re(o,n){if(o&1){let e=M();s(0,"div",4,0),w("click",function(i){x(e);let r=g();return v(r.onBackdropClick(i))}),_(2,"div",5),s(3,"div",6,1),w("click",function(i){return x(e),v(i.stopPropagation())}),y(5,ee,3,2,"div",7),s(6,"div",8),y(7,te,4,0,"div",9)(8,oe,4,0,"div",9)(9,ne,9,1,"div",10)(10,ie,29,6,"div",11),_(11,"div",12,2),z(13,0,["[class.hidden]","isLoading() || hasError() || screenCaptureService.isCapturing()"]),y(14,se,5,0,"div",13),l()()()}if(o&2){let e=g();N(e.backdropClasses()),D("z-index",e.config.zIndex||40),j("z-40",e.config.zIndex===void 0),c(2),j("opacity-50",e.config.backdrop!==!1)("opacity-0",e.config.backdrop===!1),c(),B(e.modalStyles()),N(e.modalClasses()),c(2),h("ngIf",e.config.header||e.config.showCloseButton!==!1),c(2),h("ngIf",e.screenCaptureService.isCapturing()),c(),h("ngIf",e.isLoading()&&!e.screenCaptureService.isCapturing()),c(),h("ngIf",e.hasError()),c(),h("ngIf",e.showDebugInfo&&!e.isLoading()&&!e.screenCaptureService.isCapturing()),c(),j("hidden",e.isLoading()||e.hasError()||e.screenCaptureService.isCapturing()),h("ngClass",e.isLoading()||e.hasError()||e.screenCaptureService.isCapturing()?"dynamic-component-container":""),c(3),h("ngIf",!e.hasContent()&&!e.isLoading()&&!e.hasError()&&!e.screenCaptureService.isCapturing())}}var d=class{static components=new Map;static componentsConfig=new Map;static register(n,e,t){this.components.set(n,e),t&&this.componentsConfig.set(n,C({name:n,loader:e},t)),console.log(`Componente registrado: ${n}`)}static load(n){return m(this,null,function*(){let e=this.components.get(n);if(e)try{let t=yield e();return console.log(`Componente carregado com sucesso: ${n}`,t),t}catch(t){throw console.error(`Erro ao carregar componente ${n}:`,t),t}return console.warn(`Componente n\xE3o encontrado no registro: ${n}`),null})}static isRegistered(n){return this.components.has(n)}static getRegisteredComponents(){return Array.from(this.components.keys())}static getComponentConfig(n){return this.componentsConfig.get(n)}static loadByPath(n,e){return m(this,null,function*(){try{console.log(`Tentando carregar componente por caminho: ${n}`);let t=yield import(n),i=[e,"default",...Object.keys(t).filter(r=>r.endsWith("Component")),Object.keys(t)[0]].filter(Boolean);for(let r of i)if(t[r])return console.log(`Componente encontrado: ${r} em ${n}`),t[r];throw new Error(`Nenhum componente encontrado no caminho: ${n}`)}catch(t){throw console.error(`Erro ao carregar componente por caminho ${n}:`,t),t}})}static debug(){console.log("=== ComponentRegistry Debug ==="),console.log("Componentes registrados:",this.getRegisteredComponents()),console.log("Total:",this.components.size),this.componentsConfig.forEach((n,e)=>{console.log(`- ${e}: ${n.description} [${n.category}]`)})}},ue=(()=>{class o{config={};showDebugInfo=!1;modalClose=new b;modalOpen=new b;componentLoaded=new b;componentLoadError=new b;modalBackdrop;modalContainer;dynamicComponentContainer;_isOpen=f(!1);_hasContent=f(!1);_isLoading=f(!1);_hasError=f(!1);_errorMessage=f("");injectedComponentRef=null;injector=E($);cdr=E(Q);screenCaptureService=E(q);isOpen=p(()=>this._isOpen());hasContent=p(()=>this._hasContent());isLoading=p(()=>this._isLoading());hasError=p(()=>this._hasError());errorMessage=p(()=>this._errorMessage());isRegistryInitialized=p(()=>d.getRegisteredComponents().length>0);isComponentRegistered=p(()=>this.config.componentName?d.isRegistered(this.config.componentName):!1);shouldShowModal=p(()=>{let e=this.isOpen(),t=this.screenCaptureService.isCapturing(),i=this.config.modalId;return e?t&&i?!this.screenCaptureService.isModalHidden(i):!0:!1});ngOnInit(){this.config=C({showCloseButton:!0,backdrop:!0,backdropClose:!0,position:"center",debugConsole:!0},this.config),this.config.debugConsole&&(console.log("\u{1F4CB} Modal ngOnInit - config:",this.config),this.showDebugInfo=!0)}ngAfterViewInit(){this.config.debugConsole&&console.log("\u{1F4CB} Modal ngAfterViewInit - container:",!!this.dynamicComponentContainer),this.hasComponentConfig()&&this.dynamicComponentContainer&&setTimeout(()=>{this.loadAndInjectComponent()},100)}ngOnDestroy(){this.destroyInjectedComponent(),typeof document<"u"&&document.removeEventListener("keydown",this.handleEscKey)}open(){return m(this,null,function*(){this.config.debugConsole&&console.log("\u{1F680} Modal open() called - config:",this.config),this._isOpen.set(!0),this.modalOpen.emit(),setTimeout(()=>m(this,null,function*(){this.hasComponentConfig()&&(this.config.debugConsole&&console.log("Carregando componente ap\xF3s abertura"),yield this.loadAndInjectComponent()),this.updateContentStatus()}),150),typeof document<"u"&&(document.addEventListener("keydown",this.handleEscKey),document.body.style.overflow="hidden")})}close(){this._isOpen.set(!1),this._hasContent.set(!1),this._isLoading.set(!1),this._hasError.set(!1),this.modalClose.emit(),this.destroyInjectedComponent(),typeof document<"u"&&(document.removeEventListener("keydown",this.handleEscKey),document.body.style.overflow="")}hasComponentConfig(){return!!(this.config.component||this.config.componentName||this.config.componentPath||this.config.componentLoader)}loadAndInjectComponent(){return m(this,null,function*(){if(!this.hasComponentConfig()){this.config.debugConsole&&console.warn("Nenhuma configura\xE7\xE3o de componente encontrada");return}this._isLoading.set(!0),this._hasError.set(!1),this._errorMessage.set("");try{let e=null;if(this.config.component)e=this.config.component,this.config.debugConsole&&console.log("Usando componente pr\xE9-instanciado:",e.name);else if(this.config.componentLoader)this.config.debugConsole&&console.log("Carregando via loader personalizado"),e=yield this.config.componentLoader();else if(this.config.componentName){if(this.config.debugConsole&&console.log("Carregando por nome:",this.config.componentName),e=yield d.load(this.config.componentName),!e)throw new Error(`Componente '${this.config.componentName}' n\xE3o encontrado no registro`)}else this.config.componentPath&&(this.config.debugConsole&&console.log("Carregando por caminho:",this.config.componentPath),e=yield this.loadComponentByPath(this.config.componentPath));if(!e)throw new Error("N\xE3o foi poss\xEDvel determinar o tipo do componente");yield this.injectComponent(e,this.config.componentInputs)}catch(e){let t=e instanceof Error?e.message:"Erro desconhecido";console.error("Erro ao carregar componente:",e),this._hasError.set(!0),this._errorMessage.set(t),this.componentLoadError.emit(t)}finally{this._isLoading.set(!1)}})}loadComponentByPath(e){return m(this,null,function*(){try{let t=yield import(e),i=[this.config.componentName?this.config.componentName+"Component":null,"default",Object.keys(t).find(r=>r.endsWith("Component")),Object.keys(t)[0]].filter(Boolean);for(let r of i)if(r&&t[r])return this.config.debugConsole&&console.log(`Componente encontrado: ${r}`),t[r];throw new Error(`Nenhum componente encontrado no caminho: ${e}`)}catch(t){throw new Error(`Erro ao importar componente do caminho '${e}': ${t}`)}})}retryLoadComponent(){return m(this,null,function*(){yield this.loadAndInjectComponent()})}injectComponent(e,t){return m(this,null,function*(){if(this.config.debugConsole&&(console.log("=== injectComponent called ==="),console.log("Component:",e),console.log("Inputs:",t)),this.destroyInjectedComponent(),!e)throw new Error("Componente n\xE3o fornecido");if(!this.dynamicComponentContainer)throw new Error("Container din\xE2mico n\xE3o est\xE1 dispon\xEDvel");try{this.injectedComponentRef=this.dynamicComponentContainer.createComponent(e,{injector:this.injector}),this.config.debugConsole&&console.log("Componente criado com sucesso:",this.injectedComponentRef),t&&Object.keys(t).length>0&&Object.keys(t).forEach(i=>{this.injectedComponentRef?.instance&&(this.injectedComponentRef.instance[i]=t[i],this.config.debugConsole&&console.log(`Input ${i} aplicado:`,t[i]))}),this.injectedComponentRef.instance&&typeof this.injectedComponentRef.instance.closeModal=="function"&&(this.injectedComponentRef.instance.closeModal=()=>this.close()),this.injectedComponentRef.instance&&(this.injectedComponentRef.instance.screenCaptureService=this.screenCaptureService),this.injectedComponentRef.changeDetectorRef.detectChanges(),this.cdr.detectChanges(),this._hasContent.set(!0),this.componentLoaded.emit(this.injectedComponentRef),this.config.debugConsole&&console.log("=== Component injection completed successfully ===")}catch(i){throw console.error("Erro ao injetar componente:",i),i}})}updateContentStatus(){let e=!!this.injectedComponentRef,t=this.modalContainer?.nativeElement?.querySelector("ng-content")?.children?.length>0;this._hasContent.set(e||t),this.config.debugConsole&&console.log("Content status updated:",this._hasContent())}destroyInjectedComponent(){this.injectedComponentRef&&(this.config.debugConsole&&console.log("Destroying injected component"),this.injectedComponentRef.destroy(),this.injectedComponentRef=null,this._hasContent.set(!1))}toggle(){this.isOpen()?this.close():this.open()}handleEscKey=e=>{e.key==="Escape"&&this.close()};onBackdropClick(e){this.config.backdropClose!==!1&&e.target===this.modalBackdrop?.nativeElement&&this.close()}backdropClasses(){let e=[];switch(this.config.position){case"top":e.push("items-start","pt-8");break;case"bottom":e.push("items-end","pb-8");break;default:e.push("items-center")}return e.join(" ")}modalClasses(){let e=["mx-4","my-4"];return e.push("w-full","sm:w-auto"),e.join(" ")}modalStyles(){let e={};return this.config.minWidth&&(e["min-width"]=this.config.minWidth),this.config.minHeight&&(e["min-height"]=this.config.minHeight),this.config.maxWidth&&(e["max-width"]=this.config.maxWidth),this.config.maxHeight&&(e["max-height"]=this.config.maxHeight),e}debugInfo(){return{isOpen:this.isOpen(),shouldShow:this.shouldShowModal(),hasContent:this.hasContent(),isLoading:this.isLoading(),hasError:this.hasError(),errorMessage:this.errorMessage(),hasInjectedComponent:!!this.injectedComponentRef,componentName:this.config.component?.name||this.config.componentName,containerReady:!!this.dynamicComponentContainer,isCapturing:this.screenCaptureService.isCapturing()}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=P({type:o,selectors:[["app-modal"]],viewQuery:function(t,i){if(t&1&&(S(G,5),S(U,5),S(J,5,T)),t&2){let r;k(r=R())&&(i.modalBackdrop=r.first),k(r=R())&&(i.modalContainer=r.first),k(r=R())&&(i.dynamicComponentContainer=r.first)}},inputs:{config:"config",showDebugInfo:"showDebugInfo"},outputs:{modalClose:"modalClose",modalOpen:"modalOpen",componentLoaded:"componentLoaded",componentLoadError:"componentLoadError"},ngContentSelectors:X,decls:1,vars:1,consts:[["modalBackdrop",""],["modalContainer",""],["dynamicComponentContainer",""],["class","fixed inset-0 flex items-center justify-center transition-all duration-300 ease-in-out",3,"z-40","z-index","class","click",4,"ngIf"],[1,"fixed","inset-0","flex","items-center","justify-center","transition-all","duration-300","ease-in-out",3,"click"],[1,"absolute","inset-0","bg-black","transition-opacity","duration-300"],[1,"relative","bg-white","rounded-lg","shadow-xl","transform","transition-all","duration-300","ease-in-out","max-w-full","max-h-full","overflow-hidden",3,"click"],["class","flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",4,"ngIf"],[1,"p-4","overflow-auto","max-h-full"],["class","flex items-center justify-center py-8",4,"ngIf"],["class","mb-4 p-4 bg-red-100 border border-red-300 rounded text-red-700",4,"ngIf"],["class","mb-4 p-3 bg-yellow-100 border border-yellow-300 rounded text-xs font-mono",4,"ngIf"],[3,"ngClass"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"flex","items-center","justify-between","p-4","border-b","border-gray-200","bg-gray-50"],["class","text-lg font-semibold text-gray-900",4,"ngIf"],["type","button","class","text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center transition-colors duration-200","aria-label","Fechar modal",3,"click",4,"ngIf"],[1,"text-lg","font-semibold","text-gray-900"],["type","button","aria-label","Fechar modal",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","inline-flex","justify-center","items-center","transition-colors","duration-200",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"flex","items-center","justify-center","py-8"],[1,"animate-pulse","rounded-full","h-8","w-8","bg-blue-500"],[1,"ml-2","text-gray-600"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-500"],[1,"mb-4","p-4","bg-red-100","border","border-red-300","rounded","text-red-700"],[1,"mt-3","space-y-2"],[1,"px-3","py-1","bg-red-500","text-white","rounded","text-sm","hover:bg-red-600","mr-2",3,"click"],[1,"mb-4","p-3","bg-yellow-100","border","border-yellow-300","rounded","text-xs","font-mono"],[1,"mt-2","space-y-1"],[1,"font-bold"],[1,"text-center","py-8","text-gray-500"],[1,"text-sm","mt-2"]],template:function(t,i){t&1&&(V(),y(0,re,15,23,"div",3)),t&2&&h("ngIf",i.shouldShowModal())},dependencies:[H,W,F],styles:["[_nghost-%COMP%]{display:contents}.dynamic-component-container[_ngcontent-%COMP%]{min-height:20px}"]})}return o})();var be=(()=>{class o{_modals=f([]);_modalCounter=0;_registryInitialized=!1;modals=p(()=>this._modals());hasOpenModals=p(()=>this._modals().some(e=>e.isOpen));constructor(){this.initializeRegistry()}initializeRegistry(){this._registryInitialized||(this._registryInitialized=!0,d.debug())}open(e){return m(this,null,function*(){let t=`modal-${++this._modalCounter}`;if(console.log("=== Modal Service - Opening Modal ==="),console.log("Modal ID:",t),console.log("Config:",e),!e.component)if(e.componentName)if(console.log(`Verificando componente por nome: ${e.componentName}`),!d.isRegistered(e.componentName))console.warn(`Componente '${e.componentName}' n\xE3o est\xE1 registrado!`),console.log("Componentes dispon\xEDveis:",d.getRegisteredComponents()),e.componentPath&&(console.log(`(0) Tentando carregar por caminho: ${e.componentPath}`),e.componentLoader=()=>d.loadByPath(e.componentPath,e.componentName));else{console.log(`Componente nome [${e.componentName}] encontrado no registro`);let r=yield d.load(e.componentName);r?(e.component=r,e.componentName=void 0,console.log("new config:",e)):console.warn(`Componente [${e.componentName}] n\xE3o pode ser carregado! N\xE3o foi encontrado no registro`)}else e.componentPath&&(console.log(`(1) Tentando carregar por caminho: ${e.componentPath}`),e.componentLoader=()=>d.loadByPath(e.componentPath,void 0));let i={id:t,config:I(C({showCloseButton:!0,backdrop:!0,backdropClose:!0,position:"center",debugConsole:!0},e),{zIndex:e.zIndex||1e3+this._modalCounter}),isOpen:!0};return this._modals.set([...this._modals(),i]),console.log("Modal instance criada:",i),console.log("Modais ativos:",this._modals()),t})}close(e){this._modals.set(this._modals().map(t=>t.id===e?I(C({},t),{isOpen:!1}):t)),setTimeout(()=>{this._modals.set(this._modals().filter(t=>t.id!==e))},300),console.log("Modal service - Modal closed:",e)}closeAll(){this._modals.set(this._modals().map(e=>I(C({},e),{isOpen:!1}))),setTimeout(()=>{this._modals.set([])},300)}getModal(e){return this._modals().find(t=>t.id===e)}isModalOpen(e){return this._modals().some(t=>t.id===e&&t.isOpen)}listRegisteredComponents(){return this.initializeRegistry(),d.getRegisteredComponents()}debugRegistry(){this.initializeRegistry(),d.debug()}openPatientForm(e){return m(this,null,function*(){return this.open({header:e?"Editar Paciente":"Novo Paciente",minWidth:"800px",maxWidth:"1000px",backdropClose:!1,debugConsole:!0,componentName:"PatientFormComponent",componentInputs:{patientId:e}})})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=O({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{d as a,ue as b,be as c};
