import{a as z}from"./chunk-HXFKOPUM.js";import"./chunk-5267M4YT.js";import{b as H,d as D,f as B,g as O,j as N,m as G,n as L,o as $,p as j,q as R,s as q,t as Q,u as U}from"./chunk-EUYLE5IP.js";import{w as P}from"./chunk-RLCM72IK.js";import{Ca as T,Db as C,Ib as v,Jb as c,Ra as o,Ub as M,Vb as i,Wb as p,Xb as s,ab as V,g as F,ga as y,gb as h,oa as g,ob as x,pa as f,qa as I,ra as w,sb as b,tb as S,vb as _,wb as E,xb as t,yb as a,zb as k}from"./chunk-27GLVKKX.js";var A=(r,m)=>m.key,J=(r,m)=>m.chave;function K(r,m){if(r&1&&(t(0,"p",30),i(1),a()),r&2){let e=c(2).$implicit,n=c();o(),p(n.uploadStatus[e.key]==null?null:n.uploadStatus[e.key].detalhes)}}function W(r,m){if(r&1&&(t(0,"div",28)(1,"p",29),i(2),a(),h(3,K,2,1,"p",30),a()),r&2){let e=c().$implicit,n=c();b(n.uploadStatus[e.key]!=null&&n.uploadStatus[e.key].sucesso?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),o(2),p(n.uploadStatus[e.key]==null?null:n.uploadStatus[e.key].mensagem),o(),S(n.uploadStatus[e.key]!=null&&n.uploadStatus[e.key].detalhes?3:-1)}}function X(r,m){if(r&1){let e=C();t(0,"div",17)(1,"h3",22),i(2),a(),t(3,"div",23)(4,"input",24,0),v("change",function(l){let d=g(e).$implicit,u=c();return f(u.onFileSelected(l,d.key))}),a(),t(6,"button",25),v("click",function(){g(e);let l=M(5);return f(l.click())}),i(7),a(),t(8,"p",26),i(9," Apenas arquivos .txt e .csv "),a(),h(10,W,4,4,"div",27),a()()}if(r&2){let e=m.$implicit,n=c();o(2),p(e.label),o(4),x("disabled",n.isCarregando()),o(),s(" ",n.isCarregando()?"Processando...":"Selecionar Arquivo"," "),o(3),S(n.uploadStatus[e.key]?10:-1)}}function Y(r,m){if(r&1&&(t(0,"option",34),i(1),a()),r&2){let e=m.$implicit;x("value",e.key),o(),p(e.label)}}function Z(r,m){if(r&1&&(t(0,"option",34),i(1),a()),r&2){let e=m.$implicit;x("value",e.key),o(),p(e.label)}}function ee(r,m){if(r&1){let e=C();t(0,"div",14)(1,"h2",15),i(2," Configura\xE7\xF5es da An\xE1lise "),a(),t(3,"form",31)(4,"div",16)(5,"div")(6,"label",32),i(7," Tipo de Vis\xE3o "),a(),t(8,"select",33),_(9,Y,2,2,"option",34,A),a()(),t(11,"div")(12,"label",32),i(13," Ordena\xE7\xE3o "),a(),t(14,"select",35),_(15,Z,2,2,"option",34,A),a()(),t(17,"div",36)(18,"label",37),k(19,"input",38),t(20,"span",39),i(21," Incluir Ajuda de Custo "),a()()()(),t(22,"div",40)(23,"button",41),v("click",function(){g(e);let l=c();return f(l.executarAnalise())}),i(24),a()()()()}if(r&2){let e=c();o(3),x("formGroup",e.analiseForm),o(6),E(e.tiposVisao),o(6),E(e.tiposOrdenacao),o(8),x("disabled",e.isCarregando()),o(),s(" ",e.isCarregando()?"Analisando...":"Executar An\xE1lise"," ")}}function te(r,m){if(r&1){let e=C();t(0,"tr",62),v("click",function(){let l=g(e).$implicit,d=c(2);return f(d.expandirItem(l))}),t(1,"td",63)(2,"div",64),i(3),a(),t(4,"div",26),i(5),a()(),t(6,"td",63)(7,"span",65),i(8),a()(),t(9,"td",66),i(10),a(),t(11,"td",67),i(12),a(),t(13,"td",68),i(14),a(),t(15,"td",69),i(16),a(),t(17,"td",69),i(18),a(),t(19,"td",70)(20,"div",71)(21,"span",72),i(22),a(),t(23,"span",73),i(24),a(),t(25,"span",74),i(26),a()()()()}if(r&2){let e=m.$implicit,n=c(2);o(3),s(" ",n.extrairNome(e.chave)," "),o(2),s(" ",n.extrairCodigo(e.chave)," "),o(3),p(e.descricao),o(2),s(" ",n.formatarMoeda(e.totalPago)," "),o(2),s(" ",n.formatarMoeda(e.totalOrcado)," "),o(2),s(" ",n.formatarMoeda(e.totalFaturado)," "),o(),b(e.lucroBruto>=0?"text-green-600":"text-red-600"),o(),s(" ",n.formatarMoeda(e.lucroBruto)," "),o(),b(e.margem>=0?"text-green-600":"text-red-600"),o(),s(" ",n.formatarPercentual(e.margem)," "),o(4),s("R: ",e.contadores.remuneracao,""),o(2),s("O: ",e.contadores.orcamentos,""),o(2),s("C: ",e.contadores.contas,"")}}function ae(r,m){if(r&1){let e=C();t(0,"div",20)(1,"div",42)(2,"h2",15),i(3," Resumo Geral "),a(),t(4,"div",43)(5,"div",44)(6,"span",45),i(7,"Total Pago"),a(),t(8,"span",46),i(9),a()(),t(10,"div",44)(11,"span",45),i(12,"Total Or\xE7ado"),a(),t(13,"span",47),i(14),a()(),t(15,"div",44)(16,"span",45),i(17,"Total Faturado"),a(),t(18,"span",48),i(19),a()(),t(20,"div",44)(21,"span",45),i(22,"Lucro Bruto"),a(),t(23,"span",49),i(24),a()(),t(25,"div",44)(26,"span",45),i(27,"Margem"),a(),t(28,"span",49),i(29),a()()()(),t(30,"div",42)(31,"div",50)(32,"h2",51),i(33),a(),t(34,"div",52)(35,"button",53),v("click",function(){g(e);let l=c();return f(l.exportarDados())}),i(36," Exportar CSV "),a()()(),t(37,"div",54)(38,"table",55)(39,"thead",56)(40,"tr")(41,"th",57),i(42,"Identifica\xE7\xE3o"),a(),t(43,"th",57),i(44,"Descri\xE7\xE3o"),a(),t(45,"th",58),i(46,"Total Pago"),a(),t(47,"th",58),i(48,"Total Or\xE7ado"),a(),t(49,"th",58),i(50,"Total Faturado"),a(),t(51,"th",58),i(52,"Lucro Bruto"),a(),t(53,"th",58),i(54,"Margem %"),a(),t(55,"th",59),i(56,"Contadores"),a()()(),t(57,"tbody",60),_(58,te,27,15,"tr",61,J),a()()()()()}if(r&2){let e=c();o(9),s(" ",e.formatarMoeda(e.resultadoAnalise().resumoGeral.totalPago)," "),o(5),s(" ",e.formatarMoeda(e.resultadoAnalise().resumoGeral.totalOrcado)," "),o(5),s(" ",e.formatarMoeda(e.resultadoAnalise().resumoGeral.totalFaturado)," "),o(4),b(e.resultadoAnalise().resumoGeral.lucroBruto>=0?"text-green-600":"text-red-600"),o(),s(" ",e.formatarMoeda(e.resultadoAnalise().resumoGeral.lucroBruto)," "),o(4),b(e.resultadoAnalise().resumoGeral.margem>=0?"text-green-600":"text-red-600"),o(),s(" ",e.formatarPercentual(e.resultadoAnalise().resumoGeral.margem)," "),o(4),s(" Dados Detalhados (",e.resultadoAnalise().dadosAgrupados.length," itens) "),o(25),E(e.resultadoAnalise().dadosAgrupados)}}function ie(r,m){if(r&1&&(t(0,"div",21)(1,"div",36)(2,"div",75),I(),t(3,"svg",76),k(4,"path",77),a()(),w(),t(5,"div",78)(6,"h3",79),i(7,"Erro no Processamento"),a(),t(8,"p",80),i(9),a()()()()),r&2){let e=c();o(9),p(e.erroAtual())}}var ce=(()=>{class r{dataService=y(z);fb=y(q);resultadoAnalise=T(null);uploadStatus={};statusDados=this.dataService.statusDados;temDados=this.dataService.temDados;isCarregando=this.dataService.isCarregando;erroAtual=this.dataService.erroAtual;analiseForm;tiposArquivos=[{key:"remuneracao",label:"Remunera\xE7\xE3o"},{key:"orcamentos",label:"Or\xE7amentos"},{key:"contas",label:"Contas"}];tiposVisao=[{key:"profissional",label:"Por Profissional"},{key:"profissao",label:"Por Profiss\xE3o"},{key:"convenio",label:"Por Conv\xEAnio"},{key:"paciente",label:"Por Paciente"},{key:"cooperativa",label:"Por Cooperativa"}];tiposOrdenacao=[{key:"totalPago",label:"Total Pago"},{key:"totalPrevisto",label:"Total Previsto"},{key:"totalFaturado",label:"Total Faturado"},{key:"lucroBruto",label:"Lucro Bruto"},{key:"margem",label:"Margem %"},{key:"nome",label:"Nome"}];constructor(){this.analiseForm=this.fb.group({tipoVisao:["profissional",D.required],ordenacao:["totalPago",D.required],incluirAjudaCusto:[!1]})}onFileSelected(e,n){return F(this,null,function*(){let l=e.target;if(l.files&&l.files.length>0){let d=l.files[0];delete this.uploadStatus[n];try{let u=yield this.dataService.processarArquivo(d,n);console.log("resultado:",u),u.valido?this.uploadStatus[n]={sucesso:!0,mensagem:`${n} carregado com sucesso!`,detalhes:`${this.statusDados()[n]} registros processados`}:this.uploadStatus[n]={sucesso:!1,mensagem:u.erro||"Erro no processamento",detalhes:u.sugestao}}catch(u){this.uploadStatus[n]={sucesso:!1,mensagem:"Erro inesperado no upload",detalhes:u instanceof Error?u.message:"Erro desconhecido"}}l.value=""}})}executarAnalise(){if(this.analiseForm.valid)try{let e=this.analiseForm.value,n=this.dataService.analisar(e);this.resultadoAnalise.set(n)}catch(e){console.error("Erro na an\xE1lise:",e)}}resetarDados(){this.dataService.resetarDados(),this.resultadoAnalise.set(null),this.uploadStatus={}}expandirItem(e){console.log("Detalhes do item:",e)}exportarDados(){let e=this.resultadoAnalise();if(!e)return;let n=this.converterParaCSV(e.dadosAgrupados);this.downloadCSV(n,"analise-homecare.csv")}converterParaCSV(e){let n=["Identifica\xE7\xE3o","Descri\xE7\xE3o","Total Pago","Total Or\xE7ado","Total Faturado","Lucro Bruto","Margem %","Qtd Remunera\xE7\xE3o","Qtd Or\xE7amentos","Qtd Contas"],l=e.map(d=>[d.chave,d.descricao,d.totalPago.toFixed(2),d.totalOrcado.toFixed(2),d.totalFaturado.toFixed(2),d.lucroBruto.toFixed(2),d.margem.toFixed(2),d.contadores.remuneracao,d.contadores.orcamentos,d.contadores.contas]);return[n,...l].map(d=>d.map(u=>`"${u}"`).join(",")).join(`
`)}downloadCSV(e,n){let l=new Blob([e],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");if(d.download!==void 0){let u=URL.createObjectURL(l);d.setAttribute("href",u),d.setAttribute("download",n),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}formatarMoeda(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}formatarPercentual(e){return new Intl.NumberFormat("pt-BR",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100)}extrairNome(e){return e.includes(" - ")?e.split(" - ")[1]:e}extrairCodigo(e){return e.includes(" - ")?e.split(" - ")[0]:""}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=V({type:r,selectors:[["homecare-data-component"]],decls:44,vars:7,consts:[["fileInput",""],[1,"min-h-screen","bg-gradient-to-br","from-blue-50","to-indigo-100"],[1,"container","mx-auto","p-6"],[1,"text-center","mb-8"],[1,"text-4xl","font-bold","text-gray-800","mb-2"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-8"],[1,"stats-card","bg-green-500"],[1,"text-white"],[1,"text-lg","font-semibold"],[1,"text-3xl","font-bold"],[1,"text-sm","opacity-90"],[1,"stats-card","bg-blue-500"],[1,"stats-card","bg-purple-500"],[1,"card","mb-8"],[1,"text-2xl","font-bold","text-gray-800","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"upload-section"],[1,"flex","justify-end","mt-6"],["type","button",1,"btn-secondary",3,"click","disabled"],[1,"space-y-8"],[1,"card","bg-red-50","border-red-200"],[1,"font-semibold","text-gray-700","mb-3"],[1,"border-2","border-dashed","border-gray-300","rounded-lg","p-6","text-center","hover:border-blue-400","transition-colors"],["type","file","accept",".txt,.csv",1,"hidden",3,"change"],["type","button",1,"btn-primary","mb-2",3,"click","disabled"],[1,"text-sm","text-gray-500"],[1,"mt-3","p-2","rounded",3,"class"],[1,"mt-3","p-2","rounded"],[1,"text-sm","font-medium"],[1,"text-xs","mt-1"],[1,"space-y-6",3,"formGroup"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["formControlName","tipoVisao",1,"select-input"],[3,"value"],["formControlName","ordenacao",1,"select-input"],[1,"flex","items-center"],[1,"flex","items-center","cursor-pointer"],["type","checkbox","formControlName","incluirAjudaCusto",1,"w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],[1,"ml-2","text-sm","font-medium","text-gray-700"],[1,"flex","justify-center"],["type","button",1,"btn-primary","btn-lg",3,"click","disabled"],[1,"card"],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value","text-red-600"],[1,"metric-value","text-blue-600"],[1,"metric-value","text-green-600"],[1,"metric-value"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-800"],[1,"flex","space-x-2"],["type","button",1,"btn-secondary","btn-sm",3,"click"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"table-header"],[1,"table-header","text-right"],[1,"table-header","text-center"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50","cursor-pointer"],[1,"hover:bg-gray-50","cursor-pointer",3,"click"],[1,"table-cell"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"table-cell","text-right","font-medium","text-red-600"],[1,"table-cell","text-right","font-medium","text-blue-600"],[1,"table-cell","text-right","font-medium","text-green-600"],[1,"table-cell","text-right","font-medium"],[1,"table-cell","text-center"],[1,"flex","justify-center","space-x-1"],[1,"badge","badge-green"],[1,"badge","badge-blue"],[1,"badge","badge-purple"],[1,"flex-shrink-0"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-red-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule","evenodd"],[1,"ml-3"],[1,"text-sm","font-medium","text-red-800"],[1,"mt-1","text-sm","text-red-700"]],template:function(n,l){n&1&&(t(0,"div",1)(1,"div",2)(2,"header",3)(3,"h1",4),i(4," Sistema de An\xE1lise Homecare "),a(),t(5,"p",5),i(6," An\xE1lise financeira de remunera\xE7\xE3o, or\xE7amentos e contas "),a()(),t(7,"div",6)(8,"div",7)(9,"div",8)(10,"h3",9),i(11,"Remunera\xE7\xE3o"),a(),t(12,"p",10),i(13),a(),t(14,"p",11),i(15,"registros carregados"),a()()(),t(16,"div",12)(17,"div",8)(18,"h3",9),i(19,"Or\xE7amentos"),a(),t(20,"p",10),i(21),a(),t(22,"p",11),i(23,"registros carregados"),a()()(),t(24,"div",13)(25,"div",8)(26,"h3",9),i(27,"Contas"),a(),t(28,"p",10),i(29),a(),t(30,"p",11),i(31,"registros carregados"),a()()()(),t(32,"div",14)(33,"h2",15),i(34," Upload de Arquivos "),a(),t(35,"div",16),_(36,X,11,4,"div",17,A),a(),t(38,"div",18)(39,"button",19),v("click",function(){return l.resetarDados()}),i(40," Limpar Dados "),a()()(),h(41,ee,25,3,"div",14)(42,ae,60,10,"div",20)(43,ie,10,1,"div",21),a()()),n&2&&(o(13),p(l.statusDados().remuneracao),o(8),p(l.statusDados().orcamentos),o(8),p(l.statusDados().contas),o(7),E(l.tiposArquivos),o(3),x("disabled",!l.temDados()),o(2),S(l.temDados()?41:-1),o(),S(l.resultadoAnalise()?42:-1),o(),S(l.erroAtual()?43:-1))},dependencies:[P,Q,N,j,R,H,$,B,O,U,G,L],encapsulation:2})}return r})();export{ce as HomecareDataComponent};
